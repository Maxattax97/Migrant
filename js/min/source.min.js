function setViewSize(){WIDTH=window.innerWidth,HEIGHT=window.innerHeight,STAGE.setWidth(WIDTH*PIXEL_RATIO),STAGE.setHeight(HEIGHT*PIXEL_RATIO),STAGE.draw()}function blendColors(a,b,c){a=colorNameToHex(a),b=colorNameToHex(b);var d=parseInt(a.slice(1),16),e=parseInt(b.slice(1),16),f=d>>16,g=255&d>>8,h=255&d,i=e>>16,j=255&e>>8,k=255&e;return"#"+(16777216+65536*(Math.round((i-f)*c)+f)+256*(Math.round((j-g)*c)+g)+(Math.round((k-h)*c)+h)).toString(16).slice(1)}var Kinetic={};!function(a){var b=Math.PI/180;Kinetic={version:"5.1.9",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,showWarnings:!0,Filters:{},Node:function(a){this._init(a)},Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},BaseLayer:function(a){this.___init(a)},Layer:function(a){this.____init(a)},FastLayer:function(a){this.____init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=Kinetic.DD;return a?a.isDragging:!1},isDragReady:function(){var a=Kinetic.DD;return a?!!a.node:!1},_addId:function(a,b){void 0!==b&&(this.ids[b]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,b){if(void 0!==b)for(var c=b.split(/\W+/g),d=0;d<c.length;d++)c[d]&&(void 0===this.names[c[d]]&&(this.names[c[d]]=[]),this.names[c[d]].push(a))},_removeName:function(a,b){if(void 0!==a){var c=this.names[a];if(void 0!==c){for(var d=0;d<c.length;d++){var e=c[d];e._id===b&&c.splice(d,1)}0===c.length&&delete this.names[a]}}},getAngle:function(a){return this.angleDeg?a*b:a},_parseUA:function(a){var b=a.toLowerCase(),c=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||b.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[],d=!!a.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),e=!!a.match(/IEMobile/i);return{browser:c[1]||"",version:c[2]||"0",mobile:d,ieMobile:e}},UA:void 0},Kinetic.UA=Kinetic._parseUA(a.navigator&&a.navigator.userAgent||"")}(this),function(a,b){if("object"==typeof exports){var c=b();if(global.window===global)Kinetic.document=global.document,Kinetic.window=global;else{var d=require("canvas"),e=require("jsdom").jsdom;Kinetic.document=e("<!DOCTYPE html><html><head></head><body></body></html>"),Kinetic.window=Kinetic.document.createWindow(),Kinetic.window.Image=d.Image,Kinetic._nodeCanvas=d}return Kinetic.root=a,module.exports=c,void 0}"function"==typeof define&&define.amd&&define(b),Kinetic.document=document,Kinetic.window=window,Kinetic.root=a}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var a=[].slice.call(arguments),b=a.length,c=0;for(this.length=b;b>c;c++)this[c]=a[c];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(a){for(var b=0;b<this.length;b++)a(this[b],b)},Kinetic.Collection.prototype.toArray=function(){var c,a=[],b=this.length;for(c=0;b>c;c++)a.push(this[c]);return a},Kinetic.Collection.toCollection=function(a){var d,b=new Kinetic.Collection,c=a.length;for(d=0;c>d;d++)b.push(a[d]);return b},Kinetic.Collection._mapMethod=function(a){Kinetic.Collection.prototype[a]=function(){var c,b=this.length,d=[].slice.call(arguments);for(c=0;b>c;c++)this[c][a].apply(this[c],d);return this}},Kinetic.Collection.mapMethods=function(a){var b=a.prototype;for(var c in b)Kinetic.Collection._mapMethod(c)},Kinetic.Transform=function(a){this.m=a&&a.slice()||[1,0,0,1,0,0]},Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(a){var b=this.m;return{x:b[0]*a.x+b[2]*a.y+b[4],y:b[1]*a.x+b[3]*a.y+b[5]}},translate:function(a,b){return this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b,this},scale:function(a,b){return this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b,this},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;return this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g,this},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(a,b){var c=this.m[0]+this.m[2]*b,d=this.m[1]+this.m[3]*b,e=this.m[2]+this.m[0]*a,f=this.m[3]+this.m[1]*a;return this.m[0]=c,this.m[1]=d,this.m[2]=e,this.m[3]=f,this},multiply:function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];return this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g,this},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g,this},getMatrix:function(){return this.m},setAbsolutePosition:function(a,b){var c=this.m[0],d=this.m[1],e=this.m[2],f=this.m[3],g=this.m[4],h=this.m[5],i=(c*(b-h)-d*(a-g))/(c*f-d*e),j=(a-g-e*i)/c;return this.translate(j,i)}};var a="2d",b="[object Array]",c="[object Number]",d="[object String]",e=Math.PI/180,f=180/Math.PI,g="#",h="",i="0",j="Kinetic warning: ",k="Kinetic error: ",l="rgb(",m={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},n=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(a){return!(!a||1!=a.nodeType)},_isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return Object.prototype.toString.call(a)==b},_isNumber:function(a){return Object.prototype.toString.call(a)==c},_isString:function(a){return Object.prototype.toString.call(a)==d},_throttle:function(a,b,c){var d,e,f,g=null,h=0,i=c||{},j=function(){h=i.leading===!1?0:(new Date).getTime(),g=null,f=a.apply(d,e),d=e=null};return function(){var c=(new Date).getTime();h||i.leading!==!1||(h=c);var k=b-(c-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=c,f=a.apply(d,e),d=e=null):g||i.trailing===!1||(g=setTimeout(j,k)),f}},_hasMethods:function(a){var c,b=[];for(c in a)this._isFunction(a[c])&&b.push(c);return b.length>0},createCanvasElement:function(){var a=Kinetic.document.createElement("canvas");try{a.style=a.style||{}}catch(b){}return a},isBrowser:function(){return"object"!=typeof exports},_isInDocument:function(a){for(;a=a.parentNode;)if(a==Kinetic.document)return!0;return!1},_simplifyArray:function(a){var e,f,b=[],c=a.length,d=Kinetic.Util;for(e=0;c>e;e++)f=a[e],d._isNumber(f)?f=Math.round(1e3*f)/1e3:d._isString(f)||(f=f.toString()),b.push(f);return b},_getImage:function(b,c){var d,e;if(b)if(this._isElement(b))c(b);else if(this._isString(b))d=new Kinetic.window.Image,d.onload=function(){c(d)},d.src=b;else if(b.data){e=Kinetic.Util.createCanvasElement(),e.width=b.width,e.height=b.height;var f=e.getContext(a);f.putImageData(b,0,0),this._getImage(e.toDataURL(),c)}else c(null);else c(null)},_getRGBAString:function(a){var b=a.red||0,c=a.green||0,d=a.blue||0,e=a.alpha||1;return["rgba(",b,",",c,",",d,",",e,")"].join(h)},_rgbToHex:function(a,b,c){return((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},_hexToRgb:function(a){a=a.replace(g,h);var b=parseInt(a,16);return{r:255&b>>16,g:255&b>>8,b:255&b}},getRandomColor:function(){for(var a=(16777215*Math.random()<<0).toString(16);a.length<6;)a=i+a;return g+a},get:function(a,b){return void 0===a?b:a},getRGB:function(a){var b;return a in m?(b=m[a],{r:b[0],g:b[1],b:b[2]}):a[0]===g?this._hexToRgb(a.substring(1)):a.substr(0,4)===l?(b=n.exec(a.replace(/ /g,"")),{r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)}):{r:0,g:0,b:0}},_merge:function(a,b){var c=this._clone(b);for(var d in a)c[d]=this._isObject(a[d])?this._merge(a[d],c[d]):a[d];return c},cloneObject:function(a){var b={};for(var c in a)b[c]=this._isObject(a[c])?this.cloneObject(a[c]):this._isArray(a[c])?this.cloneArray(a[c]):a[c];return b},cloneArray:function(a){return a.slice(0)},_degToRad:function(a){return a*e},_radToDeg:function(a){return a*f},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw new Error(k+a)},warn:function(a){Kinetic.root.console&&console.warn&&Kinetic.showWarnings&&console.warn(j+a)},extend:function(a,b){for(var c in b.prototype)c in a.prototype||(a.prototype[c]=b.prototype[c])},addMethods:function(a,b){var c;for(c in b)a.prototype[c]=b[c]},_getControlPoints:function(a,b,c,d,e,f,g){var h=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),i=Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2)),j=g*h/(h+i),k=g*i/(h+i),l=c-j*(e-a),m=d-j*(f-b),n=c+k*(e-a),o=d+k*(f-b);return[l,m,n,o]},_expandPoints:function(a,b){var e,f,c=a.length,d=[];for(e=2;c-2>e;e+=2)f=Kinetic.Util._getControlPoints(a[e-2],a[e-1],a[e],a[e+1],a[e+2],a[e+3],b),d.push(f[0]),d.push(f[1]),d.push(a[e]),d.push(a[e+1]),d.push(f[2]),d.push(f[3]);return d},_removeLastLetter:function(a){return a.substring(0,a.length-1)}}}(),function(){var a=Kinetic.Util.createCanvasElement(),b=a.getContext("2d"),c=Kinetic.UA.mobile?function(){var a=window.devicePixelRatio||1,c=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;return a/c}():1;Kinetic.Canvas=function(a){this.init(a)},Kinetic.Canvas.prototype={init:function(a){var b=a||{},d=b.pixelRatio||Kinetic.pixelRatio||c;this.pixelRatio=d,this._canvas=Kinetic.Util.createCanvasElement(),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio,this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio,this._canvas.style.height=a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a),this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(c){try{return this._canvas.toDataURL()}catch(d){return Kinetic.Util.warn("Unable to get data URL. "+d.message),""}}}},Kinetic.SceneCanvas=function(a){var b=a||{},c=b.width||0,d=b.height||0;Kinetic.Canvas.call(this,b),this.context=new Kinetic.SceneContext(this),this.setSize(c,d)},Kinetic.SceneCanvas.prototype={setWidth:function(a){var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a),c.scale(b,b)},setHeight:function(a){var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a),c.scale(b,b)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(a){var b=a||{},c=b.width||0,d=b.height||0;Kinetic.Canvas.call(this,b),this.context=new Kinetic.HitContext(this),this.setSize(c,d),this.hitCanvas=!0},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var a=",",b="(",c=")",d="([",e="])",f=";",g="()",h="=",i=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(a){this.init(a)},Kinetic.Context.prototype={init:function(a){this.canvas=a,this._context=a._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){var b=a.getFillEnabled();b&&this._fill(a),a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(i){var m,n,o,p,j=this.traceArr,k=j.length,l="";for(m=0;k>m;m++)n=j[m],o=n.method,o?(p=n.args,l+=o,l+=i?g:Kinetic.Util._isArray(p[0])?d+p.join(a)+e:b+p.join(a)+c):(l+=n.property,i||(l+=h+n.val)),l+=f;return l},clearTrace:function(){this.traceArr=[]},_trace:function(a){var c,b=this.traceArr;b.push(a),c=b.length,c>=Kinetic.traceArrMax&&b.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(a){var b=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,b.getWidth(),b.getHeight())},_applyLineCap:function(a){var b=a.getLineCap();b&&this.setAttr("lineCap",b)},_applyOpacity:function(a){var b=a.getAbsoluteOpacity();1!==b&&this.setAttr("globalAlpha",b)},_applyLineJoin:function(a){var b=a.getLineJoin();b&&this.setAttr("lineJoin",b)},setAttr:function(a,b){this._context[a]=b},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var a=arguments;return 2===a.length?this._context.createImageData(a[0],a[1]):1===a.length?this._context.createImageData(a[0]):void 0},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,b=this._context;3===a.length?b.drawImage(a[0],a[1],a[2]):5===a.length?b.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&b.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){var a=arguments;this._context.rotate(a[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,b=this._context;this._context.setLineDash?b.setLineDash(a[0]):"mozDash"in b?b.mozDash=a[0]:"webkitLineDash"in b&&(b.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var e,f,a=this,b=i.length,c=Kinetic.Util._simplifyArray,d=this.setAttr,g=function(b){var e,d=a[b];a[b]=function(){return f=c(Array.prototype.slice.call(arguments,0)),e=d.apply(a,arguments),a._trace({method:b,args:f}),e}};for(e=0;b>e;e++)g(i[e]);a.setAttr=function(){d.apply(a,arguments),a._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)},Kinetic.SceneContext.prototype={_fillColor:function(a){var b=a.fill()||Kinetic.Util._getRGBAString({red:a.fillRed(),green:a.fillGreen(),blue:a.fillBlue(),alpha:a.fillAlpha()});this.setAttr("fillStyle",b),a._fillFunc(this)},_fillPattern:function(a){var b=a.getFillPatternImage(),c=a.getFillPatternX(),d=a.getFillPatternY(),e=a.getFillPatternScale(),f=Kinetic.getAngle(a.getFillPatternRotation()),g=a.getFillPatternOffset(),h=a.getFillPatternRepeat();(c||d)&&this.translate(c||0,d||0),f&&this.rotate(f),e&&this.scale(e.x,e.y),g&&this.translate(-1*g.x,-1*g.y),this.setAttr("fillStyle",this.createPattern(b,h||"repeat")),this.fill()},_fillLinearGradient:function(a){var b=a.getFillLinearGradientStartPoint(),c=a.getFillLinearGradientEndPoint(),d=a.getFillLinearGradientColorStops(),e=this.createLinearGradient(b.x,b.y,c.x,c.y);if(d){for(var f=0;f<d.length;f+=2)e.addColorStop(d[f],d[f+1]);this.setAttr("fillStyle",e),this.fill()}},_fillRadialGradient:function(a){for(var b=a.getFillRadialGradientStartPoint(),c=a.getFillRadialGradientEndPoint(),d=a.getFillRadialGradientStartRadius(),e=a.getFillRadialGradientEndRadius(),f=a.getFillRadialGradientColorStops(),g=this.createRadialGradient(b.x,b.y,d,c.x,c.y,e),h=0;h<f.length;h+=2)g.addColorStop(f[h],f[h+1]);this.setAttr("fillStyle",g),this.fill()},_fill:function(a){var b=a.fill()||a.fillRed()||a.fillGreen()||a.fillBlue(),c=a.getFillPatternImage(),d=a.getFillLinearGradientColorStops(),e=a.getFillRadialGradientColorStops(),f=a.getFillPriority();b&&"color"===f?this._fillColor(a):c&&"pattern"===f?this._fillPattern(a):d&&"linear-gradient"===f?this._fillLinearGradient(a):e&&"radial-gradient"===f?this._fillRadialGradient(a):b?this._fillColor(a):c?this._fillPattern(a):d?this._fillLinearGradient(a):e&&this._fillRadialGradient(a)},_stroke:function(a){var b=a.dash(),c=a.getStrokeScaleEnabled();a.hasStroke()&&(c||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),b&&a.dashEnabled()&&this.setLineDash(b),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.stroke()||Kinetic.Util._getRGBAString({red:a.strokeRed(),green:a.strokeGreen(),blue:a.strokeBlue(),alpha:a.strokeAlpha()})),a._strokeFunc(this),c||this.restore())},_applyShadow:function(a){var b=Kinetic.Util,c=a.getAbsoluteOpacity(),d=b.get(a.getShadowColor(),"black"),e=b.get(a.getShadowBlur(),5),f=b.get(a.getShadowOpacity(),1),g=b.get(a.getShadowOffset(),{x:0,y:0});f&&this.setAttr("globalAlpha",f*c),this.setAttr("shadowColor",d),this.setAttr("shadowBlur",e),this.setAttr("shadowOffsetX",g.x),this.setAttr("shadowOffsetY",g.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)},Kinetic.HitContext.prototype={_fill:function(a){this.save(),this.setAttr("fillStyle",a.colorKey),a._fillFuncHit(this),this.restore()},_stroke:function(a){a.hasStroke()&&(this._applyLineCap(a),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var a="get",c="set";Kinetic.Factory={addGetterSetter:function(a,b,c,d,e){this.addGetter(a,b,c),this.addSetter(a,b,d,e),this.addOverloadedGetterSetter(a,b)},addGetter:function(b,c,d){var e=a+Kinetic.Util._capitalize(c);b.prototype[e]=function(){var a=this.attrs[c];return void 0===a?d:a}},addSetter:function(a,b,d,e){var f=c+Kinetic.Util._capitalize(b);a.prototype[f]=function(a){return d&&(a=d.call(this,a)),this._setAttr(b,a),e&&e.call(this),this}},addComponentsGetterSetter:function(b,d,e,f,g){var l,m,h=e.length,i=Kinetic.Util._capitalize,j=a+i(d),k=c+i(d);b.prototype[j]=function(){var a={};for(l=0;h>l;l++)m=e[l],a[m]=this.getAttr(d+i(m));return a},b.prototype[k]=function(a){var c,b=this.attrs[d];f&&(a=f.call(this,a));for(c in a)this._setAttr(d+i(c),a[c]);return this._fireChangeEvent(d,b,a),g&&g.call(this),this},this.addOverloadedGetterSetter(b,d)},addOverloadedGetterSetter:function(b,d){var e=Kinetic.Util._capitalize(d),f=c+e,g=a+e;b.prototype[d]=function(){return arguments.length?(this[f](arguments[0]),this):this[g]()}},backCompat:function(a,b){var c;for(c in b)a.prototype[c]=a.prototype[b[c]]},afterSetFilter:function(){this._filterUpToDate=!1}},Kinetic.Validators={RGBComponent:function(a){return a>255?255:0>a?0:Math.round(a)},alphaComponent:function(a){return a>1?1:1e-4>a?1e-4:a}}}(),function(){var a="absoluteOpacity",b="absoluteTransform",c="Change",d="children",e=".",f="",g="get",h="id",i="kinetic",j="listening",k="mouseenter",l="mouseleave",m="name",n="set",o="Shape",p=" ",q="stage",r="transform",s="Stage",t="visible",u=["id"],v=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(p);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(c){var d=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this.setAttrs(c),this.on(v,function(){this._clearCache(r),d._clearSelfAndDescendantCache(b)}),this.on("visibleChange.kinetic",function(){d._clearSelfAndDescendantCache(t)}),this.on("listeningChange.kinetic",function(){d._clearSelfAndDescendantCache(j)}),this.on("opacityChange.kinetic",function(){d._clearSelfAndDescendantCache(a)})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,b){var c=this._cache[a];return void 0===c&&(this._cache[a]=b.call(this)),this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a),this.children&&this.getChildren().each(function(b){b._clearSelfAndDescendantCache(a)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(a){var b=a||{},c=b.x||0,d=b.y||0,e=b.width||this.width(),f=b.height||this.height(),g=b.drawBorder||!1;if(0===e||0===f)return Kinetic.Util.warn("Width or height of caching configuration equals 0. Cache is ignored."),void 0;var h=new Kinetic.SceneCanvas({pixelRatio:1,width:e,height:f}),i=new Kinetic.SceneCanvas({pixelRatio:1,width:e,height:f}),j=new Kinetic.HitCanvas({width:e,height:f}),k=h.getContext(),l=j.getContext();return j.isCache=!0,this.clearCache(),k.save(),l.save(),g&&(k.save(),k.beginPath(),k.rect(0,0,e,f),k.closePath(),k.setAttr("strokeStyle","red"),k.setAttr("lineWidth",5),k.stroke(),k.restore()),k.translate(-1*c,-1*d),l.translate(-1*c,-1*d),"Shape"===this.nodeType&&(k.translate(-1*this.x(),-1*this.y()),l.translate(-1*this.x(),-1*this.y())),this.drawScene(h,this),this.drawHit(j,this),k.restore(),l.restore(),this._cache.canvas={scene:h,filter:i,hit:j},this},_drawCachedSceneCanvas:function(a){a.save(),this.getLayer()._applyTransform(this,a),a._applyOpacity(this),a.drawImage(this._getCachedSceneCanvas()._canvas,0,0),a.restore()},_getCachedSceneCanvas:function(){var f,g,h,i,a=this.filters(),b=this._cache.canvas,c=b.scene,d=b.filter,e=d.getContext();if(a){if(!this._filterUpToDate){try{for(f=a.length,e.clear(),e.drawImage(c._canvas,0,0),g=e.getImageData(0,0,d.getWidth(),d.getHeight()),h=0;f>h;h++)i=a[h],i.call(this,g),e.putImageData(g,0,0)}catch(j){Kinetic.Util.warn("Unable to apply filter. "+j.message)}this._filterUpToDate=!0}return d}return c},_drawCachedHitCanvas:function(a){var b=this._cache.canvas,c=b.hit;a.save(),this.getLayer()._applyTransform(this,a),a.drawImage(c._canvas,0,0),a.restore()},on:function(a,b){var g,h,i,j,k,c=a.split(p),d=c.length;for(g=0;d>g;g++)h=c[g],i=h.split(e),j=i[0],k=i[1]||f,this.eventListeners[j]||(this.eventListeners[j]=[]),this.eventListeners[j].push({name:k,handler:b});return this},off:function(a){var d,f,g,h,i,j,b=(a||"").split(p),c=b.length;if(!a)for(f in this.eventListeners)this._off(f);for(d=0;c>d;d++)if(g=b[d],h=g.split(e),i=h[0],j=h[1],i)this.eventListeners[i]&&this._off(i,j);else for(f in this.eventListeners)this._off(f,j);return this},dispatchEvent:function(a){var b={target:this,type:a.type,evt:a};this.fire(a.type,b)},addEventListener:function(a,b){this.on(a,function(a){b.call(this,a.evt)})},removeEventListener:function(a){this.off(a)},remove:function(){var c=this.getParent();return c&&c.children&&(c.children.splice(this.index,1),c._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(q),this._clearSelfAndDescendantCache(b),this._clearSelfAndDescendantCache(t),this._clearSelfAndDescendantCache(j),this._clearSelfAndDescendantCache(a),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(a){var b=g+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[b])?this[b]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),b=new Kinetic.Collection;a;)b.push(a),a=a.getParent();return b},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var b,c;if(a)for(b in a)b===d||(c=n+Kinetic.Util._capitalize(b),Kinetic.Util._isFunction(this[c])?this[c](a[b]):this._setAttr(b,a[b]));return this},isListening:function(){return this._getCache(j,this._isListening)},_isListening:function(){var a=this.getListening(),b=this.getParent();return"inherit"===a?b?b.isListening():!0:a},isVisible:function(){return this._getCache(t,this._isVisible)},_isVisible:function(){var a=this.getVisible(),b=this.getParent();return"inherit"===a?b?b.isVisible():!0:a},shouldDrawHit:function(a){var b=this.getLayer();return a&&a.isCache||b&&b.hitGraphEnabled()&&this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function h(i){for(d=[],e=i.length,f=0;e>f;f++)g=i[f],c++,g.nodeType!==o&&(d=d.concat(g.getChildren().toArray())),g._id===b._id&&(f=e);d.length>0&&d[0].getDepth()<=a&&h(d)}var d,e,f,g,a=this.getDepth(),b=this,c=0;return b.nodeType!==s&&h(b.getStage().getChildren()),c},getDepth:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},setPosition:function(a){return this.setX(a.x),this.setY(a.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),b=new Kinetic.Transform,c=this.offset();return b.m=a.slice(),b.translate(c.x,c.y),b.getTranslation()},setAbsolutePosition:function(a){var c,b=this._clearTransform();return this.attrs.x=b.x,this.attrs.y=b.y,delete b.x,delete b.y,c=this.getAbsoluteTransform(),c.invert(),c.translate(a.x,a.y),a={x:this.attrs.x+c.getTranslation().x,y:this.attrs.y+c.getTranslation().y},this.setPosition({x:a.x,y:a.y}),this._setTransform(b),this},_setTransform:function(a){var c;for(c in a)this.attrs[c]=a[c];this._clearCache(r),this._clearSelfAndDescendantCache(b)},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(r),this._clearSelfAndDescendantCache(b),a},move:function(a){var b=a.x,c=a.y,d=this.getX(),e=this.getY();return void 0!==b&&(d+=b),void 0!==c&&(e+=c),this.setPosition({x:d,y:e}),this},_eachAncestorReverse:function(a,b){var e,f,c=[],d=this.getParent();if(b&&b._id===this._id)return a(this),!0;for(c.unshift(this);d&&(!b||d._id!==b._id);)c.unshift(d),d=d.parent;for(e=c.length,f=0;e>f;f++)a(c[f])},rotate:function(a){return this.setRotation(this.getRotation()+a),this},moveToTop:function(){if(!this.parent)return Kinetic.Util.warn("Node has no parent. moveToTop function is ignored."),void 0;var a=this.index;return this.parent.children.splice(a,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){if(!this.parent)return Kinetic.Util.warn("Node has no parent. moveUp function is ignored."),void 0;var a=this.index,b=this.parent.getChildren().length;return b-1>a?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){if(!this.parent)return Kinetic.Util.warn("Node has no parent. moveDown function is ignored."),void 0;var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){if(!this.parent)return Kinetic.Util.warn("Node has no parent. moveToBottom function is ignored."),void 0;var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){if(!this.parent)return Kinetic.Util.warn("Node has no parent. zIndex parameter is ignored."),void 0;var b=this.index;return this.parent.children.splice(b,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(a,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),a},moveTo:function(a){return this.getParent()!==a&&(this.remove(),a.add(this)),this},toObject:function(){var d,e,f,g,a=Kinetic.Util,b={},c=this.getAttrs();b.attrs={};for(d in c)e=c[d],a._isFunction(e)||a._isElement(e)||a._isObject(e)&&a._hasMethods(e)||(f=this[d],delete c[d],g=f?f.call(this):null,c[d]=e,g!==e&&(b.attrs[d]=e));return b.className=this.getClassName(),b},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=this.getParent();return a?a.getLayer():null},getStage:function(){return this._getCache(q,this._getStage)},_getStage:function(){var a=this.getParent();return a?a.getStage():void 0},fire:function(a,b,c){return c?this._fireAndBubble(a,b||{}):this._fire(a,b||{}),this},getAbsoluteTransform:function(a){return a?this._getAbsoluteTransform(a):this._getCache(b,this._getAbsoluteTransform)},_getAbsoluteTransform:function(a){var c,d,b=new Kinetic.Transform;return this._eachAncestorReverse(function(a){c=a.transformsEnabled(),d=a.getTransform(),"all"===c?b.multiply(d):"position"===c&&b.translate(a.x(),a.y())},a),b},getTransform:function(){return this._getCache(r,this._getTransform)},_getTransform:function(){var a=new Kinetic.Transform,b=this.getX(),c=this.getY(),d=Kinetic.getAngle(this.getRotation()),e=this.getScaleX(),f=this.getScaleY(),g=this.getSkewX(),h=this.getSkewY(),i=this.getOffsetX(),j=this.getOffsetY();return(0!==b||0!==c)&&a.translate(b,c),0!==d&&a.rotate(d),(0!==g||0!==h)&&a.skew(g,h),(1!==e||1!==f)&&a.scale(e,f),(0!==i||0!==j)&&a.translate(-1*i,-1*j),a},clone:function(a){var d,e,f,g,h,b=this.getClassName(),c=Kinetic.Util.cloneObject(this.attrs);for(var j in u){var k=u[j];delete c[k]}for(d in a)c[d]=a[d];var l=new Kinetic[b](c);for(d in this.eventListeners)for(e=this.eventListeners[d],f=e.length,g=0;f>g;g++)h=e[g],h.name.indexOf(i)<0&&(l.eventListeners[d]||(l.eventListeners[d]=[]),l.eventListeners[d].push(h));return l},toDataURL:function(a){a=a||{};var b=a.mimeType||null,c=a.quality||null,d=this.getStage(),e=a.x||0,f=a.y||0,g=new Kinetic.SceneCanvas({width:a.width||this.getWidth()||(d?d.getWidth():0),height:a.height||this.getHeight()||(d?d.getHeight():0),pixelRatio:1}),h=g.getContext();return h.save(),(e||f)&&h.translate(-1*e,-1*f),this.drawScene(g),h.restore(),g.toDataURL(b,c)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(b){a.callback(b)})},setSize:function(a){return this.setWidth(a.width),this.setHeight(a.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}
},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Kinetic.dragDistance},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},_off:function(a,b){var d,e,c=this.eventListeners[a];for(d=0;d<c.length;d++)if(e=c[d].name,!("kinetic"===e&&"kinetic"!==b||b&&e!==b)){if(c.splice(d,1),0===c.length){delete this.eventListeners[a];break}d--}},_fireChangeEvent:function(a,b,d){this._fire(a+c,{oldVal:b,newVal:d})},setId:function(a){var b=this.getId();return Kinetic._removeId(b),Kinetic._addId(this,a),this._setAttr(h,a),this},setName:function(a){var b=this.getName();return Kinetic._removeName(b,this._id),Kinetic._addName(this,a),this._setAttr(m,a),this},setAttr:function(a,b){var c=n+Kinetic.Util._capitalize(a),d=this[c];return Kinetic.Util._isFunction(d)?d.call(this,b):this._setAttr(a,b),this},_setAttr:function(a,b){var c;void 0!==b&&(c=this.attrs[a],this.attrs[a]=b,this._fireChangeEvent(a,c,b))},_setComponentAttr:function(a,b,c){var d;void 0!==c&&(d=this.attrs[a],d||(this.attrs[a]=this.getAttr(a)),this.attrs[a][b]=c,this._fireChangeEvent(a,d,c))},_fireAndBubble:function(a,b,c){var d=!0;if(b&&this.nodeType===o&&(b.target=this),a===k&&c&&(this._id===c._id||this.isAncestorOf&&this.isAncestorOf(c))?d=!1:a===l&&c&&(this._id===c._id||this.isAncestorOf&&this.isAncestorOf(c))&&(d=!1),d){this._fire(a,b);var e=(a===k||a===l)&&(c&&c.isAncestorOf&&c.isAncestorOf(this)||!(!c||!c.isAncestorOf));b&&!b.cancelBubble&&this.parent&&this.parent.isListening()&&!e&&(c&&c.parent?this._fireAndBubble.call(this.parent,a,b,c.parent):this._fireAndBubble.call(this.parent,a,b))}},_fire:function(a,b){var d,c=this.eventListeners[a];if(b.type=a,c)for(d=0;d<c.length;d++)c[d].handler.call(this,b)},draw:function(){return this.drawScene(),this.drawHit(),this}}),Kinetic.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)},Kinetic.Node._createNode=function(a,b){var e,f,g,c=Kinetic.Node.prototype.getClassName.call(a),d=a.children;if(b&&(a.attrs.container=b),e=new Kinetic[c](a.attrs),d)for(f=d.length,g=0;f>g;g++)e.add(this._createNode(d[g]));return e},Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"position"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"id"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"scale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Node,"scaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"skew",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"skewY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,"offset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"offsetY",0),Kinetic.Factory.addSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"dragDistance"),Kinetic.Factory.addSetter(Kinetic.Node,"width",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"filters",void 0,function(a){return this._filterUpToDate=!1,a}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible","inherit"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"transformsEnabled","all"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"size"),Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Kinetic.Collection.mapMethods(Kinetic.Node)}(),function(){Kinetic.Filters.Grayscale=function(a){var d,e,b=a.data,c=b.length;for(d=0;c>d;d+=4)e=.34*b[d]+.5*b[d+1]+.16*b[d+2],b[d]=e,b[d+1]=e,b[d+2]=e}}(),function(){Kinetic.Filters.Brighten=function(a){var e,b=255*this.brightness(),c=a.data,d=c.length;for(e=0;d>e;e+=4)c[e]+=b,c[e+1]+=b,c[e+2]+=b},Kinetic.Factory.addGetterSetter(Kinetic.Node,"brightness",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Invert=function(a){var d,b=a.data,c=b.length;for(d=0;c>d;d+=4)b[d]=255-b[d],b[d+1]=255-b[d+1],b[d+2]=255-b[d+2]}}(),function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function d(d,e){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,f=d.data,g=d.width,h=d.height,G=e+e+1,H=g-1,I=h-1,J=e+1,K=J*(J+1)/2,L=new a,M=null,N=L,O=null,P=null,Q=b[e],R=c[e];for(k=1;G>k;k++)N=N.next=new a,k==J&&(M=N);for(N.next=L,o=n=0,j=0;h>j;j++){for(x=y=z=A=p=q=r=s=0,t=J*(B=f[n]),u=J*(C=f[n+1]),v=J*(D=f[n+2]),w=J*(E=f[n+3]),p+=K*B,q+=K*C,r+=K*D,s+=K*E,N=L,k=0;J>k;k++)N.r=B,N.g=C,N.b=D,N.a=E,N=N.next;for(k=1;J>k;k++)l=n+((k>H?H:k)<<2),p+=(N.r=B=f[l])*(F=J-k),q+=(N.g=C=f[l+1])*F,r+=(N.b=D=f[l+2])*F,s+=(N.a=E=f[l+3])*F,x+=B,y+=C,z+=D,A+=E,N=N.next;for(O=L,P=M,i=0;g>i;i++)f[n+3]=E=s*Q>>R,0!==E?(E=255/E,f[n]=(p*Q>>R)*E,f[n+1]=(q*Q>>R)*E,f[n+2]=(r*Q>>R)*E):f[n]=f[n+1]=f[n+2]=0,p-=t,q-=u,r-=v,s-=w,t-=O.r,u-=O.g,v-=O.b,w-=O.a,l=o+((l=i+e+1)<H?l:H)<<2,x+=O.r=f[l],y+=O.g=f[l+1],z+=O.b=f[l+2],A+=O.a=f[l+3],p+=x,q+=y,r+=z,s+=A,O=O.next,t+=B=P.r,u+=C=P.g,v+=D=P.b,w+=E=P.a,x-=B,y-=C,z-=D,A-=E,P=P.next,n+=4;o+=g}for(i=0;g>i;i++){for(y=z=A=x=q=r=s=p=0,n=i<<2,t=J*(B=f[n]),u=J*(C=f[n+1]),v=J*(D=f[n+2]),w=J*(E=f[n+3]),p+=K*B,q+=K*C,r+=K*D,s+=K*E,N=L,k=0;J>k;k++)N.r=B,N.g=C,N.b=D,N.a=E,N=N.next;for(m=g,k=1;e>=k;k++)n=m+i<<2,p+=(N.r=B=f[n])*(F=J-k),q+=(N.g=C=f[n+1])*F,r+=(N.b=D=f[n+2])*F,s+=(N.a=E=f[n+3])*F,x+=B,y+=C,z+=D,A+=E,N=N.next,I>k&&(m+=g);for(n=i,O=L,P=M,j=0;h>j;j++)l=n<<2,f[l+3]=E=s*Q>>R,E>0?(E=255/E,f[l]=(p*Q>>R)*E,f[l+1]=(q*Q>>R)*E,f[l+2]=(r*Q>>R)*E):f[l]=f[l+1]=f[l+2]=0,p-=t,q-=u,r-=v,s-=w,t-=O.r,u-=O.g,v-=O.b,w-=O.a,l=i+((l=j+J)<I?l:I)*g<<2,p+=x+=O.r=f[l],q+=y+=O.g=f[l+1],r+=z+=O.b=f[l+2],s+=A+=O.a=f[l+3],O=O.next,t+=B=P.r,u+=C=P.g,v+=D=P.b,w+=E=P.a,x-=B,y-=C,z-=D,A-=E,P=P.next,n+=g}}var b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(a){var b=Math.round(this.blurRadius());b>0&&d(a,b)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"blurRadius",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function a(a,b,c){var d=4*(c*a.width+b),e=[];return e.push(a.data[d++],a.data[d++],a.data[d++],a.data[d++]),e}function b(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}function c(a){for(var b=[0,0,0],c=0;c<a.length;c++)b[0]+=a[c][0],b[1]+=a[c][1],b[2]+=a[c][2];return b[0]/=a.length,b[1]/=a.length,b[2]/=a.length,b}function d(d,e){var f=a(d,0,0),g=a(d,d.width-1,0),h=a(d,0,d.height-1),i=a(d,d.width-1,d.height-1),j=e||10;if(b(f,g)<j&&b(g,i)<j&&b(i,h)<j&&b(h,f)<j){for(var k=c([g,f,i,h]),l=[],m=0;m<d.width*d.height;m++){var n=b(k,[d.data[4*m],d.data[4*m+1],d.data[4*m+2]]);l[m]=j>n?0:255}return l}}function e(a,b){for(var c=0;c<a.width*a.height;c++)a.data[4*c+3]=b[c]}function f(a,b,c){for(var d=[1,1,1,1,0,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=2040===k?255:0}return g}function g(a,b,c){for(var d=[1,1,1,1,1,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k>=1020?255:0}return g}function h(a,b,c){for(var d=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k}return g}Kinetic.Filters.Mask=function(a){var b=this.threshold(),c=d(a,b);return c&&(c=f(c,a.width,a.height),c=g(c,a.width,a.height),c=h(c,a.width,a.height),e(a,c)),a},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.RGB=function(a){var g,h,b=a.data,c=b.length,d=this.red(),e=this.green(),f=this.blue();for(g=0;c>g;g+=4)h=(.34*b[g]+.5*b[g+1]+.16*b[g+2])/255,b[g]=h*d,b[g+1]=h*e,b[g+2]=h*f,b[g+3]=b[g+3]},Kinetic.Factory.addGetterSetter(Kinetic.Node,"red",0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"green",0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,"blue",0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.HSV=function(a){var g,s,t,u,v,b=a.data,c=b.length,d=Math.pow(2,this.value()),e=Math.pow(2,this.saturation()),f=Math.abs(this.hue()+360)%360,h=d*e*Math.cos(f*Math.PI/180),i=d*e*Math.sin(f*Math.PI/180),j=.299*d+.701*h+.167*i,k=.587*d-.587*h+.33*i,l=.114*d-.114*h-.497*i,m=.299*d-.299*h-.328*i,n=.587*d+.413*h+.035*i,o=.114*d-.114*h+.293*i,p=.299*d-.3*h+1.25*i,q=.587*d-.586*h-1.05*i,r=.114*d+.886*h-.2*i;for(g=0;c>g;g+=4)s=b[g+0],t=b[g+1],u=b[g+2],v=b[g+3],b[g+0]=j*s+k*t+l*u,b[g+1]=m*s+n*t+o*u,b[g+2]=p*s+q*t+r*u,b[g+3]=v},Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"value",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,"hue",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"saturation",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"luminance",0,null,Kinetic.Factory.afterSetFilter),Kinetic.Filters.HSL=function(a){var h,t,u,v,w,b=a.data,c=b.length,d=1,e=Math.pow(2,this.saturation()),f=Math.abs(this.hue()+360)%360,g=127*this.luminance(),i=d*e*Math.cos(f*Math.PI/180),j=d*e*Math.sin(f*Math.PI/180),k=.299*d+.701*i+.167*j,l=.587*d-.587*i+.33*j,m=.114*d-.114*i-.497*j,n=.299*d-.299*i-.328*j,o=.587*d+.413*i+.035*j,p=.114*d-.114*i+.293*j,q=.299*d-.3*i+1.25*j,r=.587*d-.586*i-1.05*j,s=.114*d+.886*i-.2*j;for(h=0;c>h;h+=4)t=b[h+0],u=b[h+1],v=b[h+2],w=b[h+3],b[h+0]=k*t+l*u+m*v+g,b[h+1]=n*t+o*u+p*v+g,b[h+2]=q*t+r*u+s*v+g,b[h+3]=w}}(),function(){Kinetic.Filters.Emboss=function(a){var b=10*this.embossStrength(),c=255*this.embossWhiteLevel(),d=this.embossDirection(),e=this.embossBlend(),f=0,g=0,h=a.data,i=a.width,j=a.height,k=4*i,l=j;switch(d){case"top-left":f=-1,g=-1;break;case"top":f=-1,g=0;break;case"top-right":f=-1,g=1;break;case"right":f=0,g=1;break;case"bottom-right":f=1,g=1;break;case"bottom":f=1,g=0;break;case"bottom-left":f=1,g=-1;break;case"left":f=0,g=-1}do{var m=(l-1)*k,n=f;1>l+n&&(n=0),l+n>j&&(n=0);var o=4*(l-1+n)*i,p=i;do{var q=m+4*(p-1),r=g;1>p+r&&(r=0),p+r>i&&(r=0);var s=o+4*(p-1+r),t=h[q]-h[s],u=h[q+1]-h[s+1],v=h[q+2]-h[s+2],w=t,x=w>0?w:-w,y=u>0?u:-u,z=v>0?v:-v;if(y>x&&(w=u),z>x&&(w=v),w*=b,e){var A=h[q]+w,B=h[q+1]+w,C=h[q+2]+w;h[q]=A>255?255:0>A?0:A,h[q+1]=B>255?255:0>B?0:B,h[q+2]=C>255?255:0>C?0:C}else{var D=c-w;0>D?D=0:D>255&&(D=255),h[q]=h[q+1]=h[q+2]=D}}while(--p)}while(--l)},Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossStrength",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossWhiteLevel",.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossDirection","top-left",null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"embossBlend",!1,null,Kinetic.Factory.afterSetFilter)}(),function(){function a(a,b,c,d,e){var h,f=c-b,g=e-d;return 0===f?d+g/2:0===g?d:(h=(a-b)/f,h=g*h+d)}Kinetic.Filters.Enhance=function(b){var g,j,m,n,c=b.data,d=c.length,e=c[0],f=e,h=c[1],i=h,k=c[2],l=k,o=this.enhance();if(0!==o){for(n=0;d>n;n+=4)g=c[n+0],e>g?e=g:g>f&&(f=g),j=c[n+1],h>j?h=j:j>i&&(i=j),m=c[n+2],k>m?k=m:m>l&&(l=m);f===e&&(f=255,e=0),i===h&&(i=255,h=0),l===k&&(l=255,k=0);var p,q,r,s,t,u,v,w,x;for(o>0?(q=f+o*(255-f),r=e-o*(e-0),t=i+o*(255-i),u=h-o*(h-0),w=l+o*(255-l),x=k-o*(k-0)):(p=.5*(f+e),q=f+o*(f-p),r=e+o*(e-p),s=.5*(i+h),t=i+o*(i-s),u=h+o*(h-s),v=.5*(l+k),w=l+o*(l-v),x=k+o*(k-v)),n=0;d>n;n+=4)c[n+0]=a(c[n+0],e,f,r,q),c[n+1]=a(c[n+1],h,i,u,t),c[n+2]=a(c[n+2],k,l,x,w)}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"enhance",0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Posterize=function(a){var f,b=Math.round(254*this.levels())+1,c=a.data,d=c.length,e=255/b;for(f=0;d>f;f+=1)c[f]=Math.floor(c[f]/e)*e},Kinetic.Factory.addGetterSetter(Kinetic.Node,"levels",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Noise=function(a){var f,b=255*this.noise(),c=a.data,d=c.length,e=b/2;for(f=0;d>f;f+=4)c[f+0]+=e-2*e*Math.random(),c[f+1]+=e-2*e*Math.random(),c[f+2]+=e-2*e*Math.random()},Kinetic.Factory.addGetterSetter(Kinetic.Node,"noise",.2,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Pixelate=function(a){var e,f,g,h,i,j,k,n,o,p,q,r,s,t,b=Math.ceil(this.pixelSize()),c=a.width,d=a.height,l=Math.ceil(c/b),m=Math.ceil(d/b);for(a=a.data,r=0;l>r;r+=1)for(s=0;m>s;s+=1){for(h=0,i=0,j=0,k=0,n=r*b,o=n+b,p=s*b,q=p+b,t=0,e=n;o>e;e+=1)if(!(e>=c))for(f=p;q>f;f+=1)f>=d||(g=4*(c*f+e),h+=a[g+0],i+=a[g+1],j+=a[g+2],k+=a[g+3],t+=1);for(h/=t,i/=t,j/=t,e=n;o>e;e+=1)if(!(e>=c))for(f=p;q>f;f+=1)f>=d||(g=4*(c*f+e),a[g+0]=h,a[g+1]=i,a[g+2]=j,a[g+3]=k)}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"pixelSize",8,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Threshold=function(a){var e,b=255*this.threshold(),c=a.data,d=c.length;for(e=0;d>e;e+=1)c[e]=c[e]<b?0:255},Kinetic.Factory.addGetterSetter(Kinetic.Node,"threshold",.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Sepia=function(a){var f,g,h,i,j,k,l,m,n,b=a.data,c=a.width,d=a.height,e=4*c;do{f=(d-1)*e,g=c;do h=f+4*(g-1),i=b[h],j=b[h+1],k=b[h+2],l=.393*i+.769*j+.189*k,m=.349*i+.686*j+.168*k,n=.272*i+.534*j+.131*k,b[h]=l>255?255:l,b[h+1]=m>255?255:m,b[h+2]=n>255?255:n,b[h+3]=b[h+3];while(--g)}while(--d)}}(),function(){Kinetic.Filters.Solarize=function(a){var b=a.data,c=a.width,d=a.height,e=4*c,f=d;do{var g=(f-1)*e,h=c;do{var i=g+4*(h-1),j=b[i],k=b[i+1],l=b[i+2];j>127&&(j=255-j),k>127&&(k=255-k),l>127&&(l=255-l),b[i]=j,b[i+1]=k,b[i+2]=l}while(--h)}while(--f)}}(),function(){var a=function(a,b,c){var j,k,l,q,d=a.data,e=b.data,f=a.width,g=a.height,h=c.polarCenterX||f/2,i=c.polarCenterY||g/2,m=0,n=0,o=0,p=0,r=Math.sqrt(h*h+i*i);k=f-h,l=g-i,q=Math.sqrt(k*k+l*l),r=q>r?q:r;var u,v,x,y,s=g,t=f,w=360/t*Math.PI/180;for(v=0;t>v;v+=1)for(x=Math.sin(v*w),y=Math.cos(v*w),u=0;s>u;u+=1)k=Math.floor(h+r*u/s*y),l=Math.floor(i+r*u/s*x),j=4*(l*f+k),m=d[j+0],n=d[j+1],o=d[j+2],p=d[j+3],j=4*(v+u*f),e[j+0]=m,e[j+1]=n,e[j+2]=o,e[j+3]=p},b=function(a,b,c){var j,k,l,m,n,s,d=a.data,e=b.data,f=a.width,g=a.height,h=c.polarCenterX||f/2,i=c.polarCenterY||g/2,o=0,p=0,q=0,r=0,t=Math.sqrt(h*h+i*i);k=f-h,l=g-i,s=Math.sqrt(k*k+l*l),t=s>t?s:t;var w,x,z,A,u=g,v=f,y=c.polarRotation||0;for(k=0;f>k;k+=1)for(l=0;g>l;l+=1)m=k-h,n=l-i,w=Math.sqrt(m*m+n*n)*u/t,x=(180*Math.atan2(n,m)/Math.PI+360+y)%360,x=x*v/360,z=Math.floor(x),A=Math.floor(w),j=4*(A*f+z),o=d[j+0],p=d[j+1],q=d[j+2],r=d[j+3],j=4*(l*f+k),e[j+0]=o,e[j+1]=p,e[j+2]=q,e[j+3]=r},c=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(d){var g,h,i,j,k,l,m,n,o,p,e=d.width,f=d.height,q=Math.round(this.kaleidoscopePower()),r=Math.round(this.kaleidoscopeAngle()),s=Math.floor(e*(r%360)/360);if(!(1>q)){c.width=e,c.height=f;var t=c.getContext("2d").getImageData(0,0,e,f);a(d,t,{polarCenterX:e/2,polarCenterY:f/2});for(var u=e/Math.pow(2,q);8>=u;)u=2*u,q-=1;u=Math.ceil(u);var v=u,w=0,x=v,y=1;for(s+u>e&&(w=v,x=0,y=-1),h=0;f>h;h+=1)for(g=w;g!==x;g+=y)i=Math.round(g+s)%e,o=4*(e*h+i),k=t.data[o+0],l=t.data[o+1],m=t.data[o+2],n=t.data[o+3],p=4*(e*h+g),t.data[p+0]=k,t.data[p+1]=l,t.data[p+2]=m,t.data[p+3]=n;for(h=0;f>h;h+=1)for(v=Math.floor(u),j=0;q>j;j+=1){for(g=0;v+1>g;g+=1)o=4*(e*h+g),k=t.data[o+0],l=t.data[o+1],m=t.data[o+2],n=t.data[o+3],p=4*(e*h+2*v-g-1),t.data[p+0]=k,t.data[p+1]=l,t.data[p+2]=m,t.data[p+3]=n;v*=2}b(t,d,{polarRotation:0})}},Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopePower",2,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,"kaleidoscopeAngle",0,null,Kinetic.Factory.afterSetFilter)}(),function(){function d(a){setTimeout(a,1e3/60)}function e(){return c.apply(Kinetic.root,arguments)}var a=500,b=function(){return Kinetic.root.performance&&Kinetic.root.performance.now?function(){return Kinetic.root.performance.now()}:function(){return(new Date).getTime()}}(),c=function(){return Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||d}();Kinetic.Animation=function(a,c){var d=Kinetic.Animation;this.func=a,this.setLayers(c),this.id=d.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:b()}},Kinetic.Animation.prototype={setLayers:function(a){var b=[];b=a?a.length>0?a:[a]:[],this.layers=b},getLayers:function(){return this.layers},addLayer:function(a){var c,d,b=this.layers;if(b){for(c=b.length,d=0;c>d;d++)if(b[d]._id===a._id)return!1}else this.layers=[];return this.layers.push(a),!0},isRunning:function(){var d,a=Kinetic.Animation,b=a.animations,c=b.length;for(d=0;c>d;d++)if(b[d].id===this.id)return!0;return!1},start:function(){var a=Kinetic.Animation;this.stop(),this.frame.timeDiff=0,this.frame.lastTime=b(),a._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(a){this.animations.push(a),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(a){var e,b=a.id,c=this.animations,d=c.length;for(e=0;d>e;e++)if(c[e].id===b){this.animations.splice(e,1);break}},Kinetic.Animation._runFrames=function(){var d,e,f,g,h,i,j,k,l,a={},c=this.animations;for(g=0;g<c.length;g++)if(d=c[g],e=d.layers,f=d.func,d._updateFrameObject(b()),i=e.length,l=f?f.call(d,d.frame)!==!1:!0)for(h=0;i>h;h++)j=e[h],void 0!==j._id&&(a[j._id]=j);for(k in a)a[k].draw()},Kinetic.Animation._animationLoop=function(){var a=Kinetic.Animation;a.animations.length?(e(a._animationLoop),a._runFrames()):a.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var a=this;this.animRunning||(this.animRunning=!0,a._animationLoop())};var f=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a){f.call(this,a)},Kinetic.BaseLayer.prototype.batchDraw=function(){var c=this,d=Kinetic.Animation;this.batchAnim||(this.batchAnim=new d(function(){c.lastBatchDrawTime&&b()-c.lastBatchDrawTime>a&&c.batchAnim.stop()},this)),this.lastBatchDrawTime=b(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}}(this),function(){var a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},b=1,c=2,d=3,e=0;Kinetic.Tween=function(b){var h,k,c=this,d=b.node,g=d._id,i=b.easing||Kinetic.Easings.Linear,j=!!b.yoyo;h="undefined"==typeof b.duration?1:0===b.duration?.001:b.duration,this.node=d,this._id=e++,this.anim=new Kinetic.Animation(function(){c.tween.onEnterFrame()},d.getLayer()||(d instanceof Kinetic.Stage?d.getLayers():null)),this.tween=new f(k,function(a){c._tweenFunc(a)},i,0,1,1e3*h,j),this._addListeners(),Kinetic.Tween.attrs[g]||(Kinetic.Tween.attrs[g]={}),Kinetic.Tween.attrs[g][this._id]||(Kinetic.Tween.attrs[g][this._id]={}),Kinetic.Tween.tweens[g]||(Kinetic.Tween.tweens[g]={});for(k in b)void 0===a[k]&&this._addAttr(k,b[k]);this.reset(),this.onFinish=b.onFinish,this.onReset=b.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(a,b){var e,f,g,h,i,c=this.node,d=c._id;if(g=Kinetic.Tween.tweens[d][a],g&&delete Kinetic.Tween.attrs[d][g][a],e=c.getAttr(a),Kinetic.Util._isArray(b))for(f=[],i=b.length,h=0;i>h;h++)f.push(b[h]-e[h]);else f=b-e;Kinetic.Tween.attrs[d][this._id][a]={start:e,diff:f},Kinetic.Tween.tweens[d][a]=this._id},_tweenFunc:function(a){var d,e,f,g,h,i,j,b=this.node,c=Kinetic.Tween.attrs[b._id][this._id];for(d in c){if(e=c[d],f=e.start,g=e.diff,Kinetic.Util._isArray(f))for(h=[],j=f.length,i=0;j>i;i++)h.push(f[i]+g[i]*a);else h=f+g*a;b.setAttr(d,h)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()},this.tween.onReverse=function(){a.anim.start()},this.tween.onPause=function(){a.anim.stop()},this.tween.onFinish=function(){a.onFinish&&a.onFinish()},this.tween.onReset=function(){a.onReset&&a.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){return this.tween.reset(),this},seek:function(a){return this.tween.seek(1e3*a),this},pause:function(){return this.tween.pause(),this},finish:function(){return this.tween.finish(),this},destroy:function(){var d,a=this.node._id,b=this._id,c=Kinetic.Tween.tweens[a];this.pause();for(d in c)delete Kinetic.Tween.tweens[a][d];delete Kinetic.Tween.attrs[a][b]}};var f=function(a,b,c,d,e,f,g){this.prop=a,this.propFunc=b,this.begin=d,this._pos=d,this.duration=f,this._change=0,this.prevPos=0,this.yoyo=g,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=c,this._change=e-this.begin,this.pause()};f.prototype={fire:function(a){var b=this[a];b&&b()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a},getPosition:function(a){return void 0===a&&(a=this._time),this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=c,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=d,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(a){this.pause(),this._time=a,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=this.getTimer()-this._startTime;this.state===c?this.setTime(a):this.state===d&&this.setTime(this.duration-a)},pause:function(){this.state=b,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(a,b,c,d){var e=1.70158;return c*(a/=d)*a*((e+1)*a-e)+b},BackEaseOut:function(a,b,c,d){var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},BackEaseInOut:function(a,b,c,d){var e=1.70158;return(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},ElasticEaseIn:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b)},ElasticEaseOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b)},ElasticEaseInOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:2==(a/=d/2)?b+c:(f||(f=d*.3*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b:.5*e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+c+b)},BounceEaseOut:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},BounceEaseIn:function(a,b,c,d){return c-Kinetic.Easings.BounceEaseOut(d-a,0,c,d)+b},BounceEaseInOut:function(a,b,c,d){return d/2>a?.5*Kinetic.Easings.BounceEaseIn(2*a,0,c,d)+b:.5*Kinetic.Easings.BounceEaseOut(2*a-d,0,c,d)+.5*c+b},EaseIn:function(a,b,c,d){return c*(a/=d)*a+b},EaseOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},EaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},StrongEaseOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},Linear:function(a,b,c,d){return c*a/d+b}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation(function(){var a=this.dirty;return this.dirty=!1,a}),isDragging:!1,justDragged:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=Kinetic.DD,c=b.node;if(c){if(!b.isDragging){var d=c.getStage().getPointerPosition(),e=c.dragDistance(),f=Math.max(Math.abs(d.x-b.startPointerPos.x),Math.abs(d.y-b.startPointerPos.y));if(e>f)return}c._setDragPosition(a),b.isDragging||(b.isDragging=!0,c.fire("dragstart",{type:"dragstart",target:c,evt:a},!0)),c.fire("dragmove",{type:"dragmove",target:c,evt:a},!0)}},_endDragBefore:function(a){var d,e,b=Kinetic.DD,c=b.node;c&&(d=c.nodeType,e=c.getLayer(),b.anim.stop(),b.isDragging&&(b.isDragging=!1,b.justDragged=!0,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=c)),delete b.node,(e||c).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire("dragend",{type:"dragend",target:b,evt:a},!0)}},Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,b=this.getStage(),c=this.getLayer(),d=b.getPointerPosition(),e=this.getAbsolutePosition();d&&(a.node&&a.node.stopDrag(),a.node=this,a.startPointerPos=d,a.offset.x=d.x-e.x,a.offset.y=d.y-e.y,a.anim.setLayers(c||this.getLayers()),a.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(a){var b=Kinetic.DD,c=this.getStage().getPointerPosition(),d=this.getDragBoundFunc();if(c){var e={x:c.x-b.offset.x,y:c.y-b.offset.y};void 0!==d&&(e=d.call(this,e,a)),this.setAbsolutePosition(e),this._lastPos&&this._lastPos.x===e.x&&this._lastPos.y===e.y||(b.anim.dirty=!0),this._lastPos=e}},Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b),a._endDragAfter(b)},Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a),this._dragChange()};var a=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var b=Kinetic.DD;b.node&&b.node._id===this._id&&this.stopDrag(),a.call(this)},Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return!(!a.node||a.node._id!==this._id||!a.isDragging)},Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)}):this.on("mousedown.kinetic touchstart.kinetic",function(b){1!==b.evt.button&&2!==b.evt.button&&(Kinetic.DD.node||a.startDrag(b))})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===this._id&&b.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,"draggable");var b=Kinetic.document.documentElement;b.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),b.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),b.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),b.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(a){this.children=new Kinetic.Collection,Kinetic.Node.call(this,a)},getChildren:function(a){if(a){var b=new Kinetic.Collection;return this.children.each(function(c){a(c)&&b.push(c)}),b}return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var b,a=Kinetic.Collection.toCollection(this.children),c=0;c<a.length;c++)b=a[c],delete b.parent,b.index=0,b.hasChildren()&&b.removeChildren(),b.remove();return a=null,this.children=new Kinetic.Collection,this},destroyChildren:function(){for(var b,a=Kinetic.Collection.toCollection(this.children),c=0;c<a.length;c++)b=a[c],delete b.parent,b.index=0,b.destroy();return a=null,this.children=new Kinetic.Collection,this},add:function(a){if(arguments.length>1){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a.getParent())return a.moveTo(this),this;var c=this.children;return this._validateAdd(a),a.index=c.length,a.parent=this,c.push(a),this._fire("add",{child:a}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(a){var e,f,g,h,i,j,k,b=[],c=a.replace(/ /g,"").split(","),d=c.length;for(e=0;d>e;e++)if(g=c[e],"#"===g.charAt(0))i=this._getNodeById(g.slice(1)),i&&b.push(i);else if("."===g.charAt(0))h=this._getNodesByName(g.slice(1)),b=b.concat(h);else for(j=this.getChildren(),k=j.length,f=0;k>f;f++)b=b.concat(j[f]._get(g));return Kinetic.Collection.toCollection(b)},_getNodeById:function(a){var b=Kinetic.ids[a];
    return void 0!==b&&this.isAncestorOf(b)?b:null},_getNodesByName:function(a){var b=Kinetic.names[a]||[];return this._getDescendants(b)},_get:function(a){for(var b=Kinetic.Node.prototype._get.call(this,a),c=this.getChildren(),d=c.length,e=0;d>e;e++)b=b.concat(c[e]._get(a));return b},toObject:function(){var a=Kinetic.Node.prototype.toObject.call(this);a.children=[];for(var b=this.getChildren(),c=b.length,d=0;c>d;d++){var e=b[d];a.children.push(e.toObject())}return a},_getDescendants:function(a){for(var b=[],c=a.length,d=0;c>d;d++){var e=a[d];this.isAncestorOf(e)&&b.push(e)}return b},isAncestorOf:function(a){for(var b=a.getParent();b;){if(b._id===this._id)return!0;b=b.getParent()}return!1},clone:function(a){var b=Kinetic.Node.prototype.clone.call(this,a);return this.getChildren().each(function(a){b.add(a.clone())}),b},getAllIntersections:function(a){var b=[];return this.find("Shape").each(function(c){c.isVisible()&&c.intersects(a)&&b.push(c)}),b},_setChildrenIndices:function(){this.children.each(function(a,b){a.index=b})},drawScene:function(a,b){var c=this.getLayer(),d=a||c&&c.getCanvas(),e=d&&d.getContext(),f=this._cache.canvas,g=f&&f.scene;return this.isVisible()&&(g?this._drawCachedSceneCanvas(e):this._drawChildren(d,"drawScene",b)),this},drawHit:function(a,b){var c=this.getLayer(),d=a||c&&c.hitCanvas,e=d&&d.getContext(),f=this._cache.canvas,g=f&&f.hit;return this.shouldDrawHit(d)&&(c&&c.clearHitCache(),g?this._drawCachedHitCanvas(e):this._drawChildren(d,"drawHit",b)),this},_drawChildren:function(a,b,c){var i,j,d=this.getLayer(),e=a&&a.getContext(),f=this.getClipWidth(),g=this.getClipHeight(),h=f&&g;h&&d&&(i=this.getClipX(),j=this.getClipY(),e.save(),d._applyTransform(this,e),e.beginPath(),e.rect(i,j,f,g),e.clip(),e.reset()),this.children.each(function(d){d[b](a,c)}),h&&e.restore()},shouldDrawHit:function(a){var b=this.getLayer();return a&&a.isCache||b&&b.hitGraphEnabled()&&this.isVisible()&&!Kinetic.isDragging()}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,"clip",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipX"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipY"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Container,"clipHeight"),Kinetic.Collection.mapMethods(Kinetic.Container)}(),function(){function b(a){a.fill()}function c(a){a.stroke()}function d(a){a.fill()}function e(a){a.stroke()}function f(){this._clearCache(a)}var a="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(a){this.nodeType="Shape",this._fillFunc=b,this._strokeFunc=c,this._fillFuncHit=d,this._strokeFuncHit=e;for(var h,g=Kinetic.shapes;;)if(h=Kinetic.Util.getRandomColor(),h&&!(h in g))break;this.colorKey=h,g[h]=this,Kinetic.Node.call(this,a),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic",f)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(a,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},intersects:function(a){var d,b=this.getStage(),c=b.bufferHitCanvas;return c.getContext().clear(),this.drawScene(c),d=c.context.getImageData(Math.round(a.x),Math.round(a.y),1,1).data,d[3]>0},destroy:function(){Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(a,b){var i,j,k,c=this.getLayer(),d=a||c.getCanvas(),e=d.getContext(),f=this._cache.canvas,g=this.sceneFunc(),h=this.hasShadow();if(this.isVisible())if(f)this._drawCachedSceneCanvas(e);else if(g){if(e.save(),this._useBufferCanvas()){if(i=this.getStage(),j=i.bufferCanvas,k=j.getContext(),k.clear(),k.save(),k._applyLineJoin(this),c)c._applyTransform(this,k,b);else{var l=this.getAbsoluteTransform(b).getMatrix();e.transform(l[0],l[1],l[2],l[3],l[4],l[5])}g.call(this,k),k.restore(),h&&!d.hitCanvas&&(e.save(),e._applyShadow(this),e.drawImage(j._canvas,0,0),e.restore()),e._applyOpacity(this),e.drawImage(j._canvas,0,0)}else{if(e._applyLineJoin(this),c)c._applyTransform(this,e,b);else{var m=this.getAbsoluteTransform(b).getMatrix();e.transform(m[0],m[1],m[2],m[3],m[4],m[5])}h&&!d.hitCanvas&&(e.save(),e._applyShadow(this),g.call(this,e),e.restore()),e._applyOpacity(this),g.call(this,e)}e.restore()}return this},drawHit:function(a,b){var c=this.getLayer(),d=a||c.hitCanvas,e=d.getContext(),f=this.hitFunc()||this.sceneFunc(),g=this._cache.canvas,h=g&&g.hit;if(this.shouldDrawHit(d))if(c&&c.clearHitCache(),h)this._drawCachedHitCanvas(e);else if(f){if(e.save(),e._applyLineJoin(this),c)c._applyTransform(this,e,b);else{var i=this.getAbsoluteTransform(b).getMatrix();e.transform(i[0],i[1],i[2],i[3],i[4],i[5])}f.call(this,e),e.restore()}return this},drawHitFromCache:function(a){var j,k,l,m,n,o,p,q,b=a||0,c=this._cache.canvas,d=this._getCachedSceneCanvas(),e=d.getContext(),f=c.hit,g=f.getContext(),h=d.getWidth(),i=d.getHeight();g.clear();try{for(j=e.getImageData(0,0,h,i),k=j.data,l=g.getImageData(0,0,h,i),m=l.data,n=k.length,o=Kinetic.Util._hexToRgb(this.colorKey),p=0;n>p;p+=4)q=k[p+3],q>b&&(m[p]=o.r,m[p+1]=o.g,m[p+2]=o.b,m[p+3]=255);g.putImageData(l,0,0)}catch(r){Kinetic.Util.warn("Unable to draw hit graph from cached scene canvas. "+r.message)}return this}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth",2),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"sceneFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"hitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dash"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"shadowOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOffsetY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRed",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillGreen",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillBlue",0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillAlpha",1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat","repeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternOffset",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternOffsetY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillPatternScale",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleX",1),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternScaleY",1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientEndPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartPointY",0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointX",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndPointY",0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRotation",0),Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),Kinetic.Collection.mapMethods(Kinetic.Shape)}(),function(){function P(a,b){a.content.addEventListener(b,function(c){a[K+b](c)},!1)}var a="Stage",b="string",c="px",d="mouseout",e="mouseleave",f="mouseover",g="mouseenter",h="mousemove",i="mousedown",j="mouseup",k="click",l="dblclick",m="touchstart",n="touchend",o="tap",p="dbltap",q="touchmove",r="DOMMouseScroll",s="mousewheel",t="wheel",u="contentMouseout",v="contentMouseover",w="contentMousemove",x="contentMousedown",y="contentMouseup",z="contentClick",A="contentDblclick",B="contentTouchstart",C="contentTouchend",D="contentDbltap",E="contentTouchmove",F="div",G="relative",H="inline-block",I="kineticjs-content",J=" ",K="_",L="container",M="",N=[i,h,j,d,m,q,n,f,r,s,t],O=N.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(b){this.nodeType=a,Kinetic.Container.call(this,b),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Kinetic.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(a){if(typeof a===b){var c=a;if(a=Kinetic.document.getElementById(a),!a)throw"Can not find container in document with id "+c}return this._setAttr(L,a),this},shouldDrawHit:function(){return!0},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(a){return Kinetic.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this},setWidth:function(a){return Kinetic.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this},clear:function(){var c,a=this.children,b=a.length;for(c=0;b>c;c++)a[c].clear();return this},clone:function(a){return a||(a={}),a.container=Kinetic.document.createElement(F),Kinetic.Container.prototype.clone.call(this,a)},destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this),a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a);var b=Kinetic.stages.indexOf(this);b>-1&&Kinetic.stages.splice(b,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function i(d){var e=h[d],j=e.toDataURL(),k=new Kinetic.window.Image;k.onload=function(){g.drawImage(k,0,0),d<h.length-1?i(d+1):a.callback(f.toDataURL(b,c))},k.src=j}a=a||{};var b=a.mimeType||null,c=a.quality||null,d=a.x||0,e=a.y||0,f=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),g=f.getContext()._context,h=this.children;(d||e)&&g.translate(-1*d,-1*e),i(0)},toImage:function(a){var b=a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){b(a)})},this.toDataURL(a)},getIntersection:function(a){var e,f,b=this.getChildren(),c=b.length,d=c-1;for(e=d;e>=0;e--)if(f=b[e].getIntersection(a))return f;return null},_resizeDOM:function(){if(this.content){var f,g,a=this.getWidth(),b=this.getHeight(),d=this.getChildren(),e=d.length;for(this.content.style.width=a+c,this.content.style.height=b+c,this.bufferCanvas.setSize(a,b),this.bufferHitCanvas.setSize(a,b),f=0;e>f;f++)g=d[f],g.setSize(a,b),g.draw()}},add:function(a){if(!(arguments.length>1))return Kinetic.Container.prototype.add.call(this,a),a._setCanvasSize(this.width(),this.height()),a.draw(),this.content.appendChild(a.canvas._canvas),this;for(var b=0;b<arguments.length;b++)this.add(arguments[b])},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var a=0;O>a;a++)P(this,N[a])},_mouseover:function(a){Kinetic.UA.mobile||(this._setPointerPosition(a),this._fire(v,{evt:a}))},_mouseout:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble(d,{evt:a}),b._fireAndBubble(e,{evt:a}),this.targetShape=null),this.pointerPos=void 0,this._fire(u,{evt:a})}},_mousemove:function(a){if(Kinetic.UA.ieMobile)return this._touchmove(a);if(("undefined"==typeof a.webkitMovementX&&"undefined"==typeof a.webkitMovementY||0!==a.webkitMovementY||0!==a.webkitMovementX)&&!Kinetic.UA.mobile){this._setPointerPosition(a);var c,b=Kinetic.DD;Kinetic.isDragging()||(c=this.getIntersection(this.getPointerPosition()),c&&c.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===c._id?c._fireAndBubble(h,{evt:a}):(this.targetShape&&(this.targetShape._fireAndBubble(d,{evt:a},c),this.targetShape._fireAndBubble(e,{evt:a},c)),c._fireAndBubble(f,{evt:a},this.targetShape),c._fireAndBubble(g,{evt:a},this.targetShape),this.targetShape=c):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(d,{evt:a}),this.targetShape._fireAndBubble(e,{evt:a}),this.targetShape=null),this._fire(w,{evt:a})),b&&b._drag(a),a.preventDefault&&a.preventDefault()}},_mousedown:function(a){if(Kinetic.UA.ieMobile)return this._touchstart(a);if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,b&&b.isListening()&&(this.clickStartShape=b,b._fireAndBubble(i,{evt:a})),this._fire(x,{evt:a})}a.preventDefault&&a.preventDefault()},_mouseup:function(a){if(Kinetic.UA.ieMobile)return this._touchend(a);if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=this.clickStartShape,d=!1,e=Kinetic.DD;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):e&&e.justDragged?e&&(e.justDragged=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(j,{evt:a}),Kinetic.listenClickTap&&c&&c._id===b._id&&(b._fireAndBubble(k,{evt:a}),d&&b._fireAndBubble(l,{evt:a}))),this._fire(y,{evt:a}),Kinetic.listenClickTap&&(this._fire(z,{evt:a}),d&&this._fire(A,{evt:a})),Kinetic.listenClickTap=!1}a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,b&&b.isListening()&&(this.tapStartShape=b,b._fireAndBubble(m,{evt:a}),b.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(B,{evt:a})},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=!1;Kinetic.inDblClickWindow?(c=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(n,{evt:a}),Kinetic.listenClickTap&&b._id===this.tapStartShape._id&&(b._fireAndBubble(o,{evt:a}),c&&b._fireAndBubble(p,{evt:a})),b.isListening()&&a.preventDefault&&a.preventDefault()),Kinetic.listenClickTap&&(this._fire(C,{evt:a}),c&&this._fire(D,{evt:a})),Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var c,b=Kinetic.DD;Kinetic.isDragging()||(c=this.getIntersection(this.getPointerPosition()),c&&c.isListening()&&(c._fireAndBubble(q,{evt:a}),c.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(E,{evt:a})),b&&(b._drag(a),Kinetic.isDragging()&&a.preventDefault())},_DOMMouseScroll:function(a){this._mousewheel(a)},_mousewheel:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());b&&b.isListening()&&b._fireAndBubble(s,{evt:a})},_wheel:function(a){this._mousewheel(a)},_setPointerPosition:function(a){var g,b=this._getContentPosition(),c=a.offsetX,d=a.clientX,e=null,f=null;a=a?a:window.event,void 0!==a.touches?a.touches.length>0&&(g=a.touches[0],e=g.clientX-b.left,f=g.clientY-b.top):void 0!==c?(e=c,f=a.offsetY):"mozilla"===Kinetic.UA.browser?(e=a.layerX,f=a.layerY):void 0!==d&&b&&(e=d-b.left,f=a.clientY-b.top),null!==e&&null!==f&&(this.pointerPos={x:e,y:f})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();if(!a){if(Kinetic.Util.isBrowser())throw"Stage has no container. A container is required.";a=Kinetic.document.createElement(F)}a.innerHTML=M,this.content=Kinetic.document.createElement(F),this.content.style.position=G,this.content.style.display=H,this.content.className=I,this.content.setAttribute("role","presentation"),a.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1}),this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(a,b){var e,f,c=a.split(J),d=c.length;for(e=0;d>e;e++)f=c[e],this.content.addEventListener(f,b,!1)},cache:function(){Kinetic.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.")},clearCache:function(){}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container"),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,"container")}(),function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(a){this.nodeType="Layer",Kinetic.Container.call(this,a)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(a){return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this},clearHitCache:function(){this._hitImageData=void 0},setZIndex:function(a){Kinetic.Node.prototype.setZIndex.call(this,a);var b=this.getStage();return b&&(b.content.removeChild(this.getCanvas()._canvas),a<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,b.getChildren()[a+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getCanvas()._canvas;return Kinetic.Node.prototype.remove.call(this),a&&a.parentNode&&Kinetic.Util._isInDocument(a)&&a.parentNode.removeChild(a),this},getStage:function(){return this.parent},setSize:function(a,b){this.canvas.setSize(a,b)},getWidth:function(){return this.parent?this.parent.getWidth():void 0},setWidth:function(){Kinetic.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},getHeight:function(){return this.parent?this.parent.getHeight():void 0},setHeight:function(){Kinetic.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}}),Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,"clearBeforeDraw",!0),Kinetic.Collection.mapMethods(Kinetic.BaseLayer)}(),function(){var a="#",b="beforeDraw",c="draw",d=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],e=d.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(a){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.BaseLayer.call(this,a)},_setCanvasSize:function(a,b){this.canvas.setSize(a,b),this.hitCanvas.setSize(a,b)},_validateAdd:function(a){var b=a.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(a){var b,c,f,g;if(!this.hitGraphEnabled()||!this.isVisible())return null;for(var h=1,i=!1;;){for(c=0;e>c;c++){if(f=d[c],b=this._getIntersection({x:a.x+f.x*h,y:a.y+f.y*h}),g=b.shape)return g;b.antialiased&&(i=!0)}if(!i)return;h+=1}},_getImageData:function(a,b){var c=this.hitCanvas.width||1,d=this.hitCanvas.height||1,e=Math.round(b)*c+Math.round(a);return this._hitImageData||(this._hitImageData=this.hitCanvas.context.getImageData(0,0,c,d)),[this._hitImageData.data[4*e+0],this._hitImageData.data[4*e+1],this._hitImageData.data[4*e+2],this._hitImageData.data[4*e+3]]},_getIntersection:function(b){var e,f,c=this.hitCanvas.context.getImageData(b.x,b.y,1,1).data,d=c[3];return 255===d?(e=Kinetic.Util._rgbToHex(c[0],c[1],c[2]),f=Kinetic.shapes[a+e],{shape:f}):d>0?{antialiased:!0}:{}},drawScene:function(a,d){var e=this.getLayer(),f=a||e&&e.getCanvas();return this._fire(b,{node:this}),this.getClearBeforeDraw()&&f.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,f,d),this._fire(c,{node:this}),this},_applyTransform:function(a,b,c){var d=a.getAbsoluteTransform(c).getMatrix();b.transform(d[0],d[1],d[2],d[3],d[4],d[5])},drawHit:function(a,b){var c=this.getLayer(),d=a||c&&c.hitCanvas;return c&&c.getClearBeforeDraw()&&c.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,d,b),this.imageData=null,this},clear:function(a){return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this.imageData=null,this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this},setSize:function(a,b){Kinetic.BaseLayer.prototype.setSize.call(this,a,b),this.hitCanvas.setSize(a,b)}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"hitGraphEnabled",!0),Kinetic.Collection.mapMethods(Kinetic.Layer)}(),function(){Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(a){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,Kinetic.BaseLayer.call(this,a)},_validateAdd:function(a){var b=a.getType();"Shape"!==b&&Kinetic.Util.error("You may only add shapes to a fast layer.")},_setCanvasSize:function(a,b){this.canvas.setSize(a,b)},hitGraphEnabled:function(){return!1},getIntersection:function(){return null},drawScene:function(a){var b=this.getLayer(),c=a||b&&b.getCanvas();return this.getClearBeforeDraw()&&c.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,c),this},_applyTransform:function(a,b,c){if(!c||c._id!==this._id){var d=a.getTransform().getMatrix();b.transform(d[0],d[1],d[2],d[3],d[4],d[5])}},draw:function(){return this.drawScene(),this},clear:function(a){return this.getContext().clear(a),this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),this.getCanvas()._canvas.style.display=a?"block":"none",this}}),Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer),Kinetic.Collection.mapMethods(Kinetic.FastLayer)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(a){this.nodeType="Group",Kinetic.Container.call(this,a)},_validateAdd:function(a){var b=a.getType();"Group"!==b&&"Shape"!==b&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container),Kinetic.Collection.mapMethods(Kinetic.Group)}(),function(){Kinetic.Rect=function(a){this.___init(a)},Kinetic.Rect.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Rect",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getCornerRadius(),c=this.getWidth(),d=this.getHeight();a.beginPath(),b?(a.moveTo(b,0),a.lineTo(c-b,0),a.arc(c-b,b,b,3*Math.PI/2,0,!1),a.lineTo(c,d-b),a.arc(c-b,d-b,b,0,Math.PI/2,!1),a.lineTo(b,d),a.arc(b,d-b,b,Math.PI/2,Math.PI,!1),a.lineTo(0,b),a.arc(b,b,b,Math.PI,3*Math.PI/2,!1)):a.rect(0,0,c,d),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Rect)}(),function(){var a=2*Math.PI-1e-4,b="Circle";Kinetic.Circle=function(a){this.___init(a)},Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath(),b.arc(0,0,this.getRadius(),0,a,!1),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.radius()!==a/2&&this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.radius()!==a/2&&this.setRadius(a/2)},setRadius:function(a){this._setAttr("radius",a),this.setWidth(2*a),this.setHeight(2*a)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetter(Kinetic.Circle,"radius",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Circle,"radius"),Kinetic.Collection.mapMethods(Kinetic.Circle)}(),function(){var a=2*Math.PI-1e-4,b="Ellipse";Kinetic.Ellipse=function(a){this.___init(a)},Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){var c=this.getRadiusX(),d=this.getRadiusY();b.beginPath(),b.save(),c!==d&&b.scale(1,d/c),b.arc(0,0,c,0,a,!1),b.restore(),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadiusX()},getHeight:function(){return 2*this.getRadiusY()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius({y:a/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,"radius",["x","y"]),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusX",0),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,"radiusY",0),Kinetic.Collection.mapMethods(Kinetic.Ellipse)}(),function(){var a=2*Math.PI-1e-4;Kinetic.Ring=function(a){this.___init(a)},Kinetic.Ring.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Ring",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath(),b.arc(0,0,this.getInnerRadius(),0,a,!1),b.moveTo(this.getOuterRadius(),0),b.arc(0,0,this.getOuterRadius(),a,0,!0),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.outerRadius()!==a/2&&this.setOuterRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.outerRadius()!==a/2&&this.setOuterRadius(a/2)},setOuterRadius:function(a){this._setAttr("outerRadius",a),this.setWidth(2*a),this.setHeight(2*a)}},Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Ring,"innerRadius",0),Kinetic.Factory.addGetter(Kinetic.Ring,"outerRadius",0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Ring,"outerRadius"),Kinetic.Collection.mapMethods(Kinetic.Ring)}(),function(){Kinetic.Wedge=function(a){this.___init(a)},Kinetic.Wedge.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Wedge",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath(),a.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise()),a.lineTo(0,0),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1),Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Kinetic.Collection.mapMethods(Kinetic.Wedge)}(),function(){Kinetic.Arc=function(a){this.___init(a)},Kinetic.Arc.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Arc",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=Kinetic.getAngle(this.angle()),c=this.clockwise();a.beginPath(),a.arc(0,0,this.getOuterRadius(),0,b,c),a.arc(0,0,this.getInnerRadius(),b,0,!c),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"outerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,"clockwise",!1),Kinetic.Collection.mapMethods(Kinetic.Arc)}(),function(){var a="Image";Kinetic.Image=function(a){this.___init(a)},Kinetic.Image.prototype={___init:function(b){Kinetic.Shape.call(this,b),this.className=a,this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)
},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()&&this.getStage()},_sceneFunc:function(a){var e,f,g,b=this.getWidth(),c=this.getHeight(),d=this.getImage();d&&(e=this.getCropWidth(),f=this.getCropHeight(),g=e&&f?[d,this.getCropX(),this.getCropY(),e,f,0,0,b,c]:[d,0,0,b,c]),(this.hasFill()||this.hasStroke()||this.hasShadow())&&(a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)),d&&a.drawImage.apply(a,g)},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},getWidth:function(){var a=this.getImage();return this.attrs.width||(a?a.width:0)},getHeight:function(){var a=this.getImage();return this.attrs.height||(a?a.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,"crop",["x","y","width","height"]),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropX",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropY",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Image,"cropHeight",0),Kinetic.Collection.mapMethods(Kinetic.Image)}(),function(){function u(a){a.fillText(this.partialText,0,0)}function v(a){a.strokeText(this.partialText,0,0)}var a="auto",b="center",c="Change.kinetic",d="2d",e="-",f="",g="left",h="text",i="Text",j="middle",k="normal",l="px ",m=" ",n="right",o="word",p="char",q="none",r=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","lineHeight","text","width","height","wrap"],s=r.length,t=Kinetic.Util.createCanvasElement().getContext(d);Kinetic.Text=function(a){this.___init(a)},Kinetic.Text.prototype={___init:function(b){var d=this;void 0===b.width&&(b.width=a),void 0===b.height&&(b.height=a),Kinetic.Shape.call(this,b),this._fillFunc=u,this._strokeFunc=v,this.className=i;for(var e=0;s>e;e++)this.on(r[e]+c,d._setTextData);this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var k,c=this.getPadding(),d=this.getTextHeight(),e=this.getLineHeight()*d,f=this.textArr,h=f.length,i=this.getWidth();for(a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline",j),a.setAttr("textAlign",g),a.save(),a.translate(c,0),a.translate(0,c+d/2),k=0;h>k;k++){var l=f[k],m=l.text,o=l.width;a.save(),this.getAlign()===n?a.translate(i-o-2*c,0):this.getAlign()===b&&a.translate((i-o-2*c)/2,0),this.partialText=m,a.fillStrokeShape(this),a.restore(),a.translate(0,e)}a.restore()},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},setText:function(a){var b=Kinetic.Util._isString(a)?a:a.toString();return this._setAttr(h,b),this},getWidth:function(){return this.attrs.width===a?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===a?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var d,b=t,c=this.getFontSize();return b.save(),b.font=this._getContextFont(),d=b.measureText(a),b.restore(),{width:d.width,height:parseInt(c,10)}},_getContextFont:function(){return this.getFontStyle()+m+this.getFontVariant()+m+this.getFontSize()+l+this.getFontFamily()},_addTextLine:function(a,b){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return t.measureText(a).width},_setTextData:function(){var b=this.getText().split("\n"),c=+this.getFontSize(),d=0,f=this.getLineHeight()*c,g=this.attrs.width,h=this.attrs.height,i=g!==a,j=h!==a,k=this.getPadding(),l=g-2*k,n=h-2*k,o=0,r=this.getWrap(),s=r!==q,u=r!==p&&s;this.textArr=[],t.save(),t.font=this._getContextFont();for(var v=0,w=b.length;w>v;++v){var x=b[v],y=this._getTextWidth(x);if(i&&y>l)for(;x.length>0;){for(var z=0,A=x.length,B="",C=0;A>z;){var D=z+A>>>1,E=x.slice(0,D+1),F=this._getTextWidth(E);l>=F?(z=D+1,B=E,C=F):A=D}if(!B)break;if(u){var G=Math.max(B.lastIndexOf(m),B.lastIndexOf(e))+1;G>0&&(z=G,B=B.slice(0,z),C=this._getTextWidth(B))}if(this._addTextLine(B,C),d=Math.max(d,C),o+=f,!s||j&&o+f>n)break;if(x=x.slice(z),x.length>0&&(y=this._getTextWidth(x),l>=y)){this._addTextLine(x,y),o+=f,d=Math.max(d,y);break}}else this._addTextLine(x,y),o+=f,d=Math.max(d,y);if(j&&o+f>n)break}t.restore(),this.textHeight=c,this.textWidth=d}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",k),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontVariant",k),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",g),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",o),Kinetic.Factory.addGetter(Kinetic.Text,"text",f),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,"text"),Kinetic.Collection.mapMethods(Kinetic.Text)}(),function(){Kinetic.Line=function(a){this.___init(a)},Kinetic.Line.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Line",this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var f,g,h,b=this.getPoints(),c=b.length,d=this.getTension(),e=this.getClosed();if(a.beginPath(),a.moveTo(b[0],b[1]),0!==d&&c>4){for(f=this.getTensionPoints(),g=f.length,h=e?0:4,e||a.quadraticCurveTo(f[0],f[1],f[2],f[3]);g-2>h;)a.bezierCurveTo(f[h++],f[h++],f[h++],f[h++],f[h++],f[h++]);e||a.quadraticCurveTo(f[g-2],f[g-1],b[c-2],b[c-1])}else for(h=2;c>h;h+=2)a.lineTo(b[h],b[h+1]);e?(a.closePath(),a.fillStrokeShape(this)):a.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var a=this.getPoints(),b=a.length,c=this.getTension(),d=Kinetic.Util,e=d._getControlPoints(a[b-2],a[b-1],a[0],a[1],a[2],a[3],c),f=d._getControlPoints(a[b-4],a[b-3],a[b-2],a[b-1],a[0],a[1],c),g=Kinetic.Util._expandPoints(a,c),h=[e[2],e[3]].concat(g).concat([f[0],f[1],a[b-2],a[b-1],f[2],f[3],e[0],e[1],a[0],a[1]]);return h}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Line,"closed",!1),Kinetic.Factory.addGetterSetter(Kinetic.Line,"tension",0),Kinetic.Factory.addGetterSetter(Kinetic.Line,"points"),Kinetic.Collection.mapMethods(Kinetic.Line)}(),function(){Kinetic.Sprite=function(a){this.___init(a)},Kinetic.Sprite.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Sprite",this._updated=!0;var b=this;this.anim=new Kinetic.Animation(function(){var a=b._updated;return b._updated=!1,a}),this.on("animationChange.kinetic",function(){this.frameIndex(0)}),this.on("frameIndexChange.kinetic",function(){this._updated=!0}),this.on("frameRateChange.kinetic",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=e[d+0],g=e[d+1],h=e[d+2],i=e[d+3],j=this.getImage();j&&a.drawImage(j,f,g,h,i,0,0,h,i)},_hitFunc:function(a){var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=e[d+2],g=e[d+3];a.beginPath(),a.rect(0,0,f,g),a.closePath(),a.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_setInterval:function(){var a=this;this.interval=setInterval(function(){a._updateIndex()},1e3/this.getFrameRate())},start:function(){var a=this.getLayer();this.anim.setLayers(a),this._setInterval(),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var a=this.frameIndex(),b=this.getAnimation(),c=this.getAnimations(),d=c[b],e=d.length/4;e-1>a?this.frameIndex(a+1):this.frameIndex(0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameIndex",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17),Kinetic.Factory.backCompat(Kinetic.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Kinetic.Collection.mapMethods(Kinetic.Sprite)}(),function(){Kinetic.Path=function(a){this.___init(a)},Kinetic.Path.prototype={___init:function(a){this.dataArray=[];var b=this;Kinetic.Shape.call(this,a),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){b.dataArray=Kinetic.Path.parsePathData(this.getData())}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.dataArray,c=!1;a.beginPath();for(var d=0;d<b.length;d++){var e=b[d].command,f=b[d].points;switch(e){case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var g=f[0],h=f[1],i=f[2],j=f[3],k=f[4],l=f[5],m=f[6],n=f[7],o=i>j?i:j,p=i>j?1:i/j,q=i>j?j/i:1;a.translate(g,h),a.rotate(m),a.scale(p,q),a.arc(0,0,o,k,k+l,1-n),a.scale(1/p,1/q),a.rotate(-m),a.translate(-g,-h);break;case"z":a.closePath(),c=!0}}c?a.fillStrokeShape(this):a.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},Kinetic.Path.getPointOnLine=function(a,b,c,d,e,f,g){void 0===f&&(f=b),void 0===g&&(g=c);var h=(e-c)/(d-b+1e-8),i=Math.sqrt(a*a/(1+h*h));b>d&&(i*=-1);var k,j=h*i;if(d===b)k={x:f,y:g+j};else if((g-c)/(f-b+1e-8)===h)k={x:f+i,y:g+j};else{var l,m,n=this.getLineLength(b,c,d,e);if(1e-8>n)return void 0;var o=(f-b)*(d-b)+(g-c)*(e-c);o/=n*n,l=b+o*(d-b),m=c+o*(e-c);var p=this.getLineLength(f,g,l,m),q=Math.sqrt(a*a-p*p);i=Math.sqrt(q*q/(1+h*h)),b>d&&(i*=-1),j=h*i,k={x:l+i,y:m+j}}return k},Kinetic.Path.getPointOnCubicBezier=function(a,b,c,d,e,f,g,h,i){function j(a){return a*a*a}function k(a){return 3*a*a*(1-a)}function l(a){return 3*a*(1-a)*(1-a)}function m(a){return(1-a)*(1-a)*(1-a)}var n=h*j(a)+f*k(a)+d*l(a)+b*m(a),o=i*j(a)+g*k(a)+e*l(a)+c*m(a);return{x:n,y:o}},Kinetic.Path.getPointOnQuadraticBezier=function(a,b,c,d,e,f,g){function h(a){return a*a}function i(a){return 2*a*(1-a)}function j(a){return(1-a)*(1-a)}var k=f*h(a)+d*i(a)+b*j(a),l=g*h(a)+e*i(a)+c*j(a);return{x:k,y:l}},Kinetic.Path.getPointOnEllipticalArc=function(a,b,c,d,e,f){var g=Math.cos(f),h=Math.sin(f),i={x:c*Math.cos(e),y:d*Math.sin(e)};return{x:a+(i.x*g-i.y*h),y:b+(i.x*h+i.y*g)}},Kinetic.Path.parsePathData=function(a){if(!a)return[];var b=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];b=b.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)b=b.replace(new RegExp(c[d],"g"),"|"+c[d]);var e=b.split("|"),f=[],g=0,h=0;for(d=1;d<e.length;d++){var i=e[d],j=i.charAt(0);i=i.slice(1),i=i.replace(new RegExp(",-","g"),"-"),i=i.replace(new RegExp("-","g"),",-"),i=i.replace(new RegExp("e,-","g"),"e-");var k=i.split(",");k.length>0&&""===k[0]&&k.shift();for(var l=0;l<k.length;l++)k[l]=parseFloat(k[l]);for(;k.length>0&&!isNaN(k[0]);){var q,r,s,t,u,v,w,x,y,z,m=null,n=[],o=g,p=h;switch(j){case"l":g+=k.shift(),h+=k.shift(),m="L",n.push(g,h);break;case"L":g=k.shift(),h=k.shift(),n.push(g,h);break;case"m":var A=k.shift(),B=k.shift();if(g+=A,h+=B,m="M",f.length>2&&"z"===f[f.length-1].command)for(var C=f.length-2;C>=0;C--)if("M"===f[C].command){g=f[C].points[0]+A,h=f[C].points[1]+B;break}n.push(g,h),j="l";break;case"M":g=k.shift(),h=k.shift(),m="M",n.push(g,h),j="L";break;case"h":g+=k.shift(),m="L",n.push(g,h);break;case"H":g=k.shift(),m="L",n.push(g,h);break;case"v":h+=k.shift(),m="L",n.push(g,h);break;case"V":h=k.shift(),m="L",n.push(g,h);break;case"C":n.push(k.shift(),k.shift(),k.shift(),k.shift()),g=k.shift(),h=k.shift(),n.push(g,h);break;case"c":n.push(g+k.shift(),h+k.shift(),g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="C",n.push(g,h);break;case"S":r=g,s=h,q=f[f.length-1],"C"===q.command&&(r=g+(g-q.points[2]),s=h+(h-q.points[3])),n.push(r,s,k.shift(),k.shift()),g=k.shift(),h=k.shift(),m="C",n.push(g,h);break;case"s":r=g,s=h,q=f[f.length-1],"C"===q.command&&(r=g+(g-q.points[2]),s=h+(h-q.points[3])),n.push(r,s,g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="C",n.push(g,h);break;case"Q":n.push(k.shift(),k.shift()),g=k.shift(),h=k.shift(),n.push(g,h);break;case"q":n.push(g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="Q",n.push(g,h);break;case"T":r=g,s=h,q=f[f.length-1],"Q"===q.command&&(r=g+(g-q.points[0]),s=h+(h-q.points[1])),g=k.shift(),h=k.shift(),m="Q",n.push(r,s,g,h);break;case"t":r=g,s=h,q=f[f.length-1],"Q"===q.command&&(r=g+(g-q.points[0]),s=h+(h-q.points[1])),g+=k.shift(),h+=k.shift(),m="Q",n.push(r,s,g,h);break;case"A":t=k.shift(),u=k.shift(),v=k.shift(),w=k.shift(),x=k.shift(),y=g,z=h,g=k.shift(),h=k.shift(),m="A",n=this.convertEndpointToCenterParameterization(y,z,g,h,w,x,t,u,v);break;case"a":t=k.shift(),u=k.shift(),v=k.shift(),w=k.shift(),x=k.shift(),y=g,z=h,g+=k.shift(),h+=k.shift(),m="A",n=this.convertEndpointToCenterParameterization(y,z,g,h,w,x,t,u,v)}f.push({command:m||j,points:n,start:{x:o,y:p},pathLength:this.calcLength(o,p,m||j,n)})}("z"===j||"Z"===j)&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f},Kinetic.Path.calcLength=function(a,b,c,d){var e,f,g,h,i=Kinetic.Path;switch(c){case"L":return i.getLineLength(a,b,d[0],d[1]);case"C":for(e=0,f=i.getPointOnCubicBezier(0,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),h=.01;1>=h;h+=.01)g=i.getPointOnCubicBezier(h,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"Q":for(e=0,f=i.getPointOnQuadraticBezier(0,a,b,d[0],d[1],d[2],d[3]),h=.01;1>=h;h+=.01)g=i.getPointOnQuadraticBezier(h,a,b,d[0],d[1],d[2],d[3]),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"A":e=0;var j=d[4],k=d[5],l=d[4]+k,m=Math.PI/180;if(Math.abs(j-l)<m&&(m=Math.abs(j-l)),f=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],j,0),0>k)for(h=j-m;h>l;h-=m)g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],h,0),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;else for(h=j+m;l>h;h+=m)g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],h,0),e+=i.getLineLength(f.x,f.y,g.x,g.y),f=g;return g=i.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],l,0),e+=i.getLineLength(f.x,f.y,g.x,g.y)}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(a,b,c,d,e,f,g,h,i){var j=i*(Math.PI/180),k=Math.cos(j)*(a-c)/2+Math.sin(j)*(b-d)/2,l=-1*Math.sin(j)*(a-c)/2+Math.cos(j)*(b-d)/2,m=k*k/(g*g)+l*l/(h*h);m>1&&(g*=Math.sqrt(m),h*=Math.sqrt(m));var n=Math.sqrt((g*g*h*h-g*g*l*l-h*h*k*k)/(g*g*l*l+h*h*k*k));e===f&&(n*=-1),isNaN(n)&&(n=0);var o=n*g*l/h,p=n*-h*k/g,q=(a+c)/2+Math.cos(j)*o-Math.sin(j)*p,r=(b+d)/2+Math.sin(j)*o+Math.cos(j)*p,s=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},t=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(s(a)*s(b))},u=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(t(a,b))},v=u([1,0],[(k-o)/g,(l-p)/h]),w=[(k-o)/g,(l-p)/h],x=[(-1*k-o)/g,(-1*l-p)/h],y=u(w,x);return t(w,x)<=-1&&(y=Math.PI),t(w,x)>=1&&(y=0),0===f&&y>0&&(y-=2*Math.PI),1===f&&0>y&&(y+=2*Math.PI),[q,r,g,h,v,y,j,f]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data"),Kinetic.Collection.mapMethods(Kinetic.Path)}(),function(){function c(a){a.fillText(this.partialText,0,0)}function d(a){a.strokeText(this.partialText,0,0)}var a="",b="normal";Kinetic.TextPath=function(a){this.___init(a)},Kinetic.TextPath.prototype={___init:function(a){var b=this;this.dummyCanvas=Kinetic.Util.createCanvasElement(),this.dataArray=[],Kinetic.Shape.call(this,a),this._fillFunc=c,this._strokeFunc=d,this._fillFuncHit=c,this._strokeFuncHit=d,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){b.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",b._setTextData),b._setTextData(),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline","middle"),a.setAttr("textAlign","left"),a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++){a.save();var d=b[c].p0;a.translate(d.x,d.y),a.rotate(b[c].rotation),this.partialText=b[c].text,a.fillStrokeShape(this),a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas,c=b.getContext("2d");c.save(),c.font=this._getContextFont();var d=c.measureText(a);return c.restore(),{width:d.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this,b=this._getTextSize(this.attrs.text);this.textWidth=b.width,this.textHeight=b.height,this.glyphInfo=[];for(var d,e,f,c=this.attrs.text.split(""),g=-1,h=0,i=function(){h=0;for(var b=a.dataArray,c=g+1;c<b.length;c++){if(b[c].pathLength>0)return g=c,b[c];"M"==b[c].command&&(d={x:b[c].points[0],y:b[c].points[1]})}return{}},j=function(b){var c=a._getTextSize(b).width,g=0,j=0;for(e=void 0;Math.abs(c-g)/c>.01&&25>j;){j++;for(var k=g;void 0===f;)f=i(),f&&k+f.pathLength<c&&(k+=f.pathLength,f=void 0);if(f==={}||void 0===d)return void 0;var l=!1;switch(f.command){case"L":Kinetic.Path.getLineLength(d.x,d.y,f.points[0],f.points[1])>c?e=Kinetic.Path.getPointOnLine(c,d.x,d.y,f.points[0],f.points[1],d.x,d.y):f=void 0;break;case"A":var m=f.points[4],n=f.points[5],o=f.points[4]+n;0===h?h=m+1e-8:c>g?h+=Math.PI/180*n/Math.abs(n):h-=Math.PI/360*n/Math.abs(n),(0>n&&o>h||n>=0&&h>o)&&(h=o,l=!0),e=Kinetic.Path.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],h,f.points[6]);break;case"C":0===h?h=c>f.pathLength?1e-8:c/f.pathLength:c>g?h+=(c-g)/f.pathLength:h-=(g-c)/f.pathLength,h>1&&(h=1,l=!0),e=Kinetic.Path.getPointOnCubicBezier(h,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3],f.points[4],f.points[5]);break;case"Q":0===h?h=c/f.pathLength:c>g?h+=(c-g)/f.pathLength:h-=(g-c)/f.pathLength,h>1&&(h=1,l=!0),e=Kinetic.Path.getPointOnQuadraticBezier(h,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3])}void 0!==e&&(g=Kinetic.Path.getLineLength(d.x,d.y,e.x,e.y)),l&&(l=!1,f=void 0)}},k=0;k<c.length&&(j(c[k]),void 0!==d&&void 0!==e);k++){var l=Kinetic.Path.getLineLength(d.x,d.y,e.x,e.y),m=0,n=Kinetic.Path.getPointOnLine(m+l/2,d.x,d.y,e.x,e.y),o=Math.atan2(e.y-d.y,e.x-d.x);this.glyphInfo.push({transposeX:n.x,transposeY:n.y,text:c[k],rotation:o,p0:d,p1:e}),d=e}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily","Arial"),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",b),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontVariant",b),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",a),Kinetic.Collection.mapMethods(Kinetic.TextPath)}(),function(){Kinetic.RegularPolygon=function(a){this.___init(a)},Kinetic.RegularPolygon.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="RegularPolygon",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var d,e,f,b=this.attrs.sides,c=this.attrs.radius;for(a.beginPath(),a.moveTo(0,0-c),d=1;b>d;d++)e=c*Math.sin(2*d*Math.PI/b),f=-1*c*Math.cos(2*d*Math.PI/b),a.lineTo(e,f);a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0),Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)}(),function(){Kinetic.Star=function(a){this.___init(a)},Kinetic.Star.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Star",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();a.beginPath(),a.moveTo(0,0-c);for(var e=1;2*d>e;e++){var f=0===e%2?c:b,g=f*Math.sin(e*Math.PI/d),h=-1*f*Math.cos(e*Math.PI/d);a.lineTo(g,h)}a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",5),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Star)}(),function(){var a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],b="Change.kinetic",c="none",d="up",e="right",f="down",g="left",h="Label",i=a.length;Kinetic.Label=function(a){this.____init(a)},Kinetic.Label.prototype={____init:function(a){var b=this;Kinetic.Group.call(this,a),this.className=h,this.on("add.kinetic",function(a){b._addListeners(a.child),b._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(c){var e,d=this,f=function(){d._sync()};for(e=0;i>e;e++)c.on(a[e]+b,f)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var c,h,i,j,k,l,m,a=this.getText(),b=this.getTag();if(a&&b){switch(c=a.getWidth(),h=a.getHeight(),i=b.getPointerDirection(),j=b.getPointerWidth(),m=b.getPointerHeight(),k=0,l=0,i){case d:k=c/2,l=-1*m;break;case e:k=c+j,l=h/2;break;case f:k=c/2,l=h+m;break;case g:k=-1*j,l=h/2}b.setAttrs({x:-1*k,y:-1*l,width:c,height:h}),a.setAttrs({x:-1*k,y:-1*l})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Collection.mapMethods(Kinetic.Label),Kinetic.Tag=function(a){this.___init(a)},Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Tag",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getWidth(),c=this.getHeight(),h=this.getPointerDirection(),i=this.getPointerWidth(),j=this.getPointerHeight(),k=this.getCornerRadius();a.beginPath(),a.moveTo(0,0),h===d&&(a.lineTo((b-i)/2,0),a.lineTo(b/2,-1*j),a.lineTo((b+i)/2,0)),k?(a.lineTo(b-k,0),a.arc(b-k,k,k,3*Math.PI/2,0,!1)):a.lineTo(b,0),h===e&&(a.lineTo(b,(c-j)/2),a.lineTo(b+i,c/2),a.lineTo(b,(c+j)/2)),k?(a.lineTo(b,c-k),a.arc(b-k,c-k,k,0,Math.PI/2,!1)):a.lineTo(b,c),h===f&&(a.lineTo((b+i)/2,c),a.lineTo(b/2,c+j),a.lineTo((b-i)/2,c)),k?(a.lineTo(k,c),a.arc(k,c-k,k,Math.PI/2,Math.PI,!1)):a.lineTo(0,c),h===g&&(a.lineTo(0,(c+j)/2),a.lineTo(-1*i,c/2),a.lineTo(0,(c-j)/2)),k&&(a.lineTo(0,k),a.arc(k,k,k,Math.PI,3*Math.PI/2,!1)),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",c),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0),Kinetic.Collection.mapMethods(Kinetic.Tag)}(),function(){Kinetic.Arrow=function(a){this.____init(a)},Kinetic.Arrow.prototype={____init:function(a){Kinetic.Line.call(this,a),this.className="Arrow"},_sceneFunc:function(a){var b=2*Math.PI,c=this.points(),d=c.length,e=c[d-2]-c[d-4],f=c[d-1]-c[d-3],g=(Math.atan2(f,e)+b)%b,h=this.pointerLength(),i=this.pointerWidth();a.save(),a.beginPath(),a.translate(c[d-2],c[d-1]),a.rotate(g),a.moveTo(0,0),a.lineTo(-h,i/2),a.lineTo(-h,-i/2),a.closePath(),a.restore(),this.pointerAtBeginning()&&(a.save(),a.translate(c[0],c[1]),e=c[2]-c[0],f=c[3]-c[1],a.rotate((Math.atan2(-f,-e)+b)%b),a.moveTo(0,0),a.lineTo(-10,6),a.lineTo(-10,-6),a.closePath(),a.restore()),a.fillStrokeShape(this),Kinetic.Line.prototype._sceneFunc.apply(this,arguments)}},Kinetic.Util.extend(Kinetic.Arrow,Kinetic.Line),Kinetic.Factory.addGetterSetter(Kinetic.Arrow,"pointerLength",10),Kinetic.Factory.addGetterSetter(Kinetic.Arrow,"pointerWidth",10),Kinetic.Factory.addGetterSetter(Kinetic.Arrow,"pointerAtBeginning",!1),Kinetic.Collection.mapMethods(Kinetic.Arrow)}(),LANGUAGE=0,DIALOG={},DIALOG.backgroundTitle=["SELECT A BACKGROUND","SELECCIONE UN ANTECEDENTE"],DIALOG.background1=["While out working at a steel mill in San Salvador, El Salvador one day, your home was raided by Los Zetas. Inside was your family of six. The house was looted, and your children killed. However, Los Zetas have kidnapped your wife, and are demanding a large sum of money to release her. Local authorities are offering no assistance. You put together what you have left, and head for the North. By doing this you not only have a hope of saving your wife, but also of escaping the violence.\n\n\nPERKS:\nNone\n\nAILMENTS:\nNone",""],DIALOG.background2=["You are more privileged than most. You own a small automobile workshop in Michoacán, Mexico. All was well until gang members from Mara Salvatrucha showed up. They destroyed your workshop, looted what they could find, broke your leg, then began to raze the building. You only narrowly escaped. Scraping what little you have left together, you prepare yourself for a long journey North. There is nothing left for you here.\n\n\nPERKS:\nNone\n\nAILMENTS:\nBroken Leg",""],DIALOG.background3=["You are a simple coffee farmer who lives in the small town of Urraco in Honduras. You have a wife and three children. Your little girl has been diagnosed with leukemia, and the treatment is becoming expensive. Your only hope for saving her is by making it to the United States. There, you can find a farming job and send money back home to your family.\n\n\nPERKS:\nOutdoorsman\n\nAILMENTS:\nNone",""],DIALOG.background4=["You work at a textile factory where you make just barely enough money to feed your family, although at times it is not enough. Your children are hungry, and sickness is beginning to set in. Additionally, you are worried about the growing gang violence here in Guatemala. Hoping to save your family, you plan to immigrate to the United States and send home whatever you can. Although the journey could be life threatening, you decide that letting your family starve here is no better.\n\n\nPERKS:\nNone\n\nAILMENTS:\nTuberculosis",""],DIALOG.background5=["Your father is a maize farmer, and the economy has recently gone down hill in El Salvador. Your father, having difficulty feeding your family, acquired a loan from a drug lord to try to increase food growth. The drug lord is now demanding that your father pays his dues, yet he has nothing left. Looking up to your peers who have made the perilous journey to the United States, you grab a handful of necessities and leave in the night. You must save your family.\n\n\nPERKS:\nLightweight\n\nAILMENTS:\nNone",""],DIALOG.continue=["Continue","Continúe"],DIALOG.usdollar=["US Dollar","EU Dólar"],DIALOG.honduranLempira=["Honduran Lempira","Lempira Hondureño"],DIALOG.mexicanPeso=["Mexican Peso","Peso Mejicano"],DIALOG.guatemalanQuetzal=["Guatemalan Quetzal","Quetzal Guatemalteco"],DIALOG.to=["to","a"],DIALOG.water=["Water","Agua"],DIALOG.food=["Food","Comida"],DIALOG.overEncumbered=["You are over encumbered.","Tienes más gravado."],DIALOG.store=["Store","Tienda"],DIALOG.embark=["Embark","Embarque"],DIALOG.inventory=["Inventory","Inventario"],DIALOG.carryWeight=["Carry Weight","Carga"],DIALOG.map=["Map","Mapa"],DIALOG.close=["Close","Cierre"],DIALOG.hunger=["Hunger","Hambre"],DIALOG.thirst=["Thirst","Sed"],DIALOG.energy=["Energy","Energía"],DIALOG.temperature=["Temperature","Temperatura"],DIALOG.diedOfHunger=["You have died of hunger.","Has muerto de hambre."],DIALOG.diedOfThirst=["You have died of dehydration.","Has muerto de deshidratación."],DIALOG.diedOfHeartAttack=["You have died of a heart attack.","Has muerto de un ataque al corazón."],DIALOG.diedOfHypothermia=["You have died of hypothermia.","Has muerto de hipotermia."],DIALOG.diedOfHyperthermia=["You have died of hyperthermia.","Has muerto de hipertermia."],DIALOG.diedOfExhaustion=["You collapse from extreme exhaustion.","Has colapsado de agotamiento extremo."],DIALOG.quit=["Quit","Deje"],DIALOG.eat=["Eat","Coma"],DIALOG.drink=["Drink","Beba"],DIALOG.rest=["Rest","Descanse"],DIALOG.outOfFood=["You have no food left to eat.","No tienes comida para comer."],DIALOG.outOfWater=["You have no water left to drink.","No tienes agua para beber"],DIALOG.verifyRest=["Are you sure you would like to rest? This action will consume a cycle.","¿Está seguro que quieres descansar? Esta acción consumirá un ciclo."],DIALOG.yes=["Yes","Sí"],DIALOG.no=["No","No"],DIALOG.nextDay=["Next Cycle","Próximo Ciclo"],DIALOG.gameOver=["Game Over","Fin"],DIALOG.status=["Status","Estado"],DIALOG.sonoranDesert=["Sonoran Desert","Desierto de Sonora"],DIALOG.mexico=["Mexico","México"],DIALOG.desert=["Desert","Desierto"],DIALOG.tropical=["Tropical","Tropical"],DIALOG.savanna=["Savanna","Sabana"],DIALOG.gainBrokenLimb=["You have broken a limb.","Has roto un miembro."],DIALOG.loseBrokenLimb=["Your limb no longer hinders you.","Su miembro ya no lo impide."],DIALOG.brokenLimb=["Broken Limb","Miembro Roto"],DIALOG.gainTuberculosis=["You have become sick with Tuberculosis.","Has convertido en enfermo con Tuberculosis."],DIALOG.loseTuberculosis=["You no longer have Tuberculosis.","Ya no tienes Tuberculosis."],DIALOG.tuberculosis=["Tuberculosis","Tuberculosis"],DIALOG.gainScabies=["You have become infested with Scabies.","Has convertido en infestado con Sarna."],DIALOG.loseScabies=["You are no longer infested with Scabies.","Ya no estás infestadas con Sarna."],DIALOG.scabies=["Scabies","Sarna"],DIALOG.gainDengueFever=["You were bit by a mosquito and now have Dengue Fever.","Fuiste mordido por un mosquito y ahora tienes el Fiebre Dengue."],DIALOG.loseDengueFever=["You no longer have Dengue Fever.","Ya no tienes el Fiebre Dengue."],DIALOG.dengueFever=["Dengue Fever","Fiebre Dengue"],DIALOG.gainDehydration=["The heat and work has made you dehydrated.","El calor y el trabajo te ha hecho deshidratado."],DIALOG.loseDehydration=["You are no longer dehydrated.","Ya no estás deshidratado."],DIALOG.dehydration=["Dehydration","Deshidratación"],DIALOG.gainExhaustion=["The immense amount of work put in to traveling has made you exhausted.","La inmensa cantidad de trabajo invertido para viajar te ha hecho agotado."],DIALOG.loseExhaustion=["You are no longer exhausted.","Ya no estás agotado."],DIALOG.exhaustion=["Exhaustion","Agotamiento"],DIALOG.gainSprain=["You have tripped and sprained your ankle.","Has tropezado y has torcido tu tobillo."],DIALOG.loseSprain=["Your sprain has fully healed.","Tu esguince ha sanado completamente."],DIALOG.sprain=["Sprain","Esguince"],DIALOG.gainDiarrhea=["You have become sick with diarrhea.","Has convertido en enfermo con diarrea."],DIALOG.loseDiarrhea=["You no longer have diarrhea.","Ya no tienes la diarrea."],DIALOG.diarrhea=["Diarrhea","Diarrea"],DIALOG.gainMalnourishment=["Lack of eating has caused you to become malnourished.","Falta de comer ha causado que empieza a desnutrirse."],DIALOG.loseMalnourishment=["Your nourishment has improved.","Has mejorado tu alimento."],DIALOG.malnutrition=["Malnutrition","Desnutrición"],DIALOG.day=["Day","Día"],DIALOG.night=["Night","Noche"],DIALOG.none=["None","Nada"],DIALOG.perks=["Perks","Beneficios"],DIALOG.ailments=["Ailments","Enfermadades"],DIALOG.distanceTraveled=["Distance Traveled","Distancia Viajó"],DIALOG.region=["Region","Región"],DIALOG.biome=["Biome","Bioma"],DIALOG.environmentalTemperature=["Environmental Temperature","Temperatura Ambiental"],DIALOG.leave=["Leave","Salga"],DIALOG.regionGuatemala=["You have entered the country of Guatemala. There are only a few days travel until you reach Mexico.","Has entrado al país de Guatemala. Hay sólo unos pocos días de viaje hasta llegar a México."],DIALOG.regionMexico=["You have just exited the borders of Guatemala and entered those of Mexico. The longest stretch of the journey starts here.","Acabas de salir de las fronteras de Guatemala y entraste los de México. El tramo más largo del viaje comienza aquí."],DIALOG.regionSonora=["You have entered the area known to be the Sonoran Desert.","Has entrado a la zona conocida como el desierto de Sonora."],DIALOG.chanceStore=["You come across a small shop selling various items. Would you like to enter?","Te encuentras con una pequeña tienda de venta de diversos artículos. ¿Te gustaría entrar?"],DIALOG.grupoBeta=["Grupo Beta","Grupo Beta"],DIALOG.chanceGrupoBetaBrokenLimb=["A member of Grupo Beta notices your prominent limp. She gives you a splint and helps you put it on. Your speed is no longer hindered.","Un miembro del Grupo Beta avisos prominente su cojera. Ella te da una tablilla y te ayuda a ponérmelo. La velocidad ya no se ve obstaculizada."],DIALOG.chanceDesertEncounter=["You see someone far off in the distance. It is likely that they do not see you. The intent of this person is unknown. Should you approach the person?","Ves a alguien lejos en la distancia. Es probable que no te ve. La intención de esta persona es desconocida. ¿Debes acercarse a la persona?"],DIALOG.friendlyAmerican=["Friendly American","American Amistoso"],DIALOG.chanceFriendlyAmericanMedicine=["A seemingly friendly American offers you medicine. Do you accept?","Un estadounidense aparentemente amigable le ofrece la medicina. ¿Aceptas?"],DIALOG.coyote=["Coyote","Coyote"],DIALOG.chanceCoyote1=["A Coyote approaches you and says he can bring you ","Un Coyote se te acerca y dice que él te puede traer "],DIALOG.chanceCoyote2=[" kilometers. He requests "," kilómetros. Pide "],DIALOG.chanceCoyote3=[" for his services. Following him will consume a cycle. Do you accept his offer?"," por sus servicios. Siguiéndolo consumirá un ciclo. ¿Aceptarías su oferta?"],DIALOG.coyoteMislead=["The coyote has mislead you, and has instead brought you backward, away from America.","El coyote ha engañar y en cambio te ha traído hacia atrás, lejos de América."],DIALOG.losZetas=["Los Zetas","Los Zetas"],DIALOG.chanceLosZetasKill=["You had an encounter with Los Zetas and were caught in some cross fire. You were shot and killed.",""],DIALOG.maraSalvatrucha=["Mara Salvatrucha",""],DIALOG.chanceMaraSalvatruchaRob=["A member of the Mara Salvatrucha gang has robbed you.",""],DIALOG.encounter=["Encounter",""],DIALOG.chanceApprehended=["The local authorities have apprehended you and are sending you back to your native country. You wonder if someone had reported you.",""],DIALOG.laBestia=["La Bestia",""],DIALOG.chanceLaBestia=["You have found a train apart of the network known as La Bestia passing by. Would you like to board the top of the train?",""],DIALOG.chanceLaBestiaToll1=["A member of Los Zetas informs you that this particular train is apart of their territory, and that you must pay a fine of ",""],DIALOG.chanceLaBestiaToll2=[" in order to board the top of the train. Will you pay this toll?",""],DIALOG.chanceLaBestiaFallOff=["Riding atop the La Bestia, the rumbling of the train soothes you to sleep. You have rolled off the train and have been seriosuly injured.",""],DIALOG.chanceLaBestiaFallOffDie=["Riding atop the La Bestia, the rumbling of the train soothes you to sleep. You have rolled off the train and have been killed beneath the tracks.",""],DIALOG.chanceLaBestiaApprehended=["You watch as migrant control suddenly fills the top of the train. They start cuffing anyone in sight. You have been caught.",""],DIALOG.chanceLaBestiaScaredOff=["You watch as migrant control suddenly fills the top of the train. You jump off the train in order to escape. Doing so injured you.",""],DIALOG.chanceLaBestiaGangPushOffDie=["Los Zetas gang members make their way across the top of the train. Thinking you didn't pay their toll, they push you off the train, causing a brief death.",""],DIALOG.chanceLaBestiaGangPushOffInjure=["Los Zetas gang members make their way across the top of the train. Thinking you didn't pay their toll, they push you off the train, causing an injury.",""],DIALOG.walking=["Walking",""],DIALOG.modeOfTravel=["Mode Of Travel",""],DIALOG.chanceBananaFarm=["You notice a nearby banana farm with plenty of bananas ripe for the picking. Do you want to take a few for the journey?",""],DIALOG.chanceBananaFarmShoo=["A disgruntled farmer rushes out and forces you to leave empty handed.",""],DIALOG.supplies=["Supplies",""],DIALOG.chanceSupplies=["You have come across a stash of packaged food and potable water.",""],DIALOG.oddJob=["Odd Job",""],DIALOG.chanceOddJob1=["A rancher approaches you and asks if you would be interested in some work. He offers ",""],DIALOG.chanceOddJob2=[" for your services. Do you accept? This action will consume a cycle.",""],DIALOG.chanceBarrels=["You find a barrel with an orange flag. Inside is potable water, which you quench your thirst from. Do you want to take some with you?",""],DIALOG.shelter=["Shelter",""],DIALOG.chanceShelter=["You have discovered a nearby community shelter that would allow you to recuperate. Would you like to enter? This action will consume a cycle.",""],DIALOG.chanceShelterRaid=["As you sit down to eat a bowl of soup, a team of authorities bust down the door and start detaining migrants left and right. You included.",""],DIALOG.patriot=["Patriot",""],DIALOG.chancePatriot=["An American patriot yells for you to leave and to never come back. He has a gun and fires off shots to frighten you. You leave his presence quickly.",""],DIALOG.chanceCoyoteKill=["The Coyote brings you out to the middle of nowhere. He then pulls a gun, points it at you, and squeezes the trigger. It appears you have been betrayed for your money.",""],DIALOG.outdoorsman=["Outdoorsman",""],DIALOG.lightweight=["Lightweight",""],DIALOG.winTitle=["YOU HAVE MADE IT\nTO AMERICA",""],DIALOG.score=["Score",""],DIALOG.chanceOutdoorsmanFindWater=["As a skilled outdoorsman, you have discovered some potable water. You collect some for the journey.",""],DIALOG.chanceOutdoorsmanFindFood=["As a skilled outdoorsman, you have identified a few berry bushes with ripe and edible berries. You collect some for the journey.",""],DIALOG.chanceDesertStream=["Amidst the intense heat of the desert, you have found a small stream of water. Would you like to take a drink?",""],DIALOG.chanceDesertStreamDrown=["Leaning in a little too far to take a drink, you fall into the water. The bottom of the stream is quite muddy, and you can not escape. You have drowned.",""];
var IMAGES={};IMAGES["titleBackground.jpg"]=new Image,IMAGES["map.jpg"]=new Image,IMAGES["walkingMan.png"]=new Image,IMAGES["winBackground.jpg"]=new Image;var loadedImageCount=0,imageCount=0;for(var image in IMAGES)IMAGES.hasOwnProperty(image)&&(IMAGES[image].src=-1==image.indexOf("/")?"img/"+image:image,IMAGES[image].onload=function(){-1==loadedImageCount?loadedImageCount=1:loadedImageCount++},imageCount++);var WIDTH=window.innerWidth,HEIGHT=window.innerHeight,PIXEL_RATIO=window.devicePixelRatio||1,STAGE=new Kinetic.Stage({container:"viewport",width:WIDTH,height:HEIGHT}),background=new Kinetic.Layer({}),foreground=new Kinetic.Layer({}),ui=new Kinetic.Layer({});setViewSize(),window.addEventListener("resize",setViewSize),window.addEventListener("orientationchange",setViewSize),STAGE.add(background),STAGE.add(foreground),STAGE.add(ui);var Annotation=function(a){Kinetic.Group.call(this,{width:a.width||100,height:a.height||50,x:0,y:0}),this.className="Annotation",this.base=new Kinetic.Rect({width:a.width||100,height:a.height||50,x:0,y:0,fill:a.fill||"white",stroke:"black",strokeWidth:1}),this.text=new Kinetic.Text({width:a.width||100,height:a.height||50,x:0,y:0,text:a.text||"Annotation",fill:a.fontColor||"black",strokeWidth:1,fontFamily:a.fontFamily||"Arial",fontSize:a.fontSize||15,align:"center"});var b=this.text.getTextHeight()*this.text.attrs.text.split("\n").length;this.text.offsetY(-1*(a.height||50)/2+b/2),this.add(this.base),this.add(this.text),this.position({x:a.x||WIDTH/2-a.width/2,y:a.y||HEIGHT/2-a.height/2}),void 0!=a.layer&&a.layer.add(this)};Annotation.prototype=Object.create(Kinetic.Group.prototype),Annotation.prototype.constructor=Annotation;var Button=function(a){Annotation.call(this,a),this.className="Button",this.text.text=a.text||"Button",this.base.strokeWidth(2),this.base.on("click tap",function(a){a.target.parent._onActivate()}),this.text.on("click tap",function(a){a.target.parent._onActivate()}),void 0!=a.layer&&a.layer.add(this),this.refreshColors=function(){this._originalColor=this.base.fill(),this._darkColor=shadeColor(this._originalColor,-50)},this.refreshColors()};Button.prototype=Object.create(Annotation.prototype),Button.prototype.constructor=Button,Button.prototype.onActivate=function(){},Button.prototype._onActivate=function(){var a=this;a.base.fill(a._darkColor),a.getLayer().draw(),setTimeout(function(){a.base.fill(a._originalColor),a.getLayer().draw(),a.onActivate()},50)};var Pane=function(a){a.width=a.width||300,a.height=a.height||100,1==a.yesNo&&(a.buttons=2,a.noClose=!0),a.buttons>=1&&(a.height+=70),Kinetic.Group.call(this,{width:a.width,height:a.height,x:0,y:0}),this.className="Pane";var b=this;this.base=new Kinetic.Rect({width:a.width,height:a.height,x:0,y:0,stroke:"black",fill:"white",strokeWidth:1}),this.add(this.base),1!=a.noClose&&(this.button=new Button({width:25,height:25,text:"X"}),this.button.position({x:a.width-25,y:0}),this.button.base.setAttrs({fill:a.buttonColor||"#EEEEEE",stroke:a.buttonStroke||"rgba(238, 238, 238, 1)"}),this.button.text.setAttr("fontSize",15)),this.message=a.buttons>=1?new Kinetic.Text({width:a.width-10,height:a.height-25-70,x:5,y:25,fill:"black",text:a.message||"",fontSize:a.fontSize||15}):new Kinetic.Text({width:a.width-10,height:a.height-25,x:5,y:25,fill:"black",text:a.message||"",fontSize:a.fontSize||15}),0!=a.center&&(this.message.setAttr("align","center"),this.message.offsetY(-10)),this.title=1==a.noClose?new Kinetic.Text({width:a.width,height:25,x:1,y:1,fill:"black",text:(a.title||"").toUpperCase(),fontStyle:"bold",fontSize:20,align:"center"}):new Kinetic.Text({width:a.width-25,height:25,x:1,y:1,fill:"black",text:(a.title||"").toUpperCase(),fontStyle:"bold",fontSize:20,align:"center"}),a.buttons>=1&&(this.option1=new Button({width:75,height:50,text:"Option 1",x:a.width-85,y:a.height-60}),this.add(this.option1)),a.buttons>=2&&(this.option2=new Button({width:75,height:50,text:"Option 2",x:a.width-170,y:a.height-60}),this.add(this.option2)),a.buttons>=3&&(this.option3=new Button({width:75,height:50,text:"Option 3",x:a.width-255,y:a.height-60}),this.add(this.option3)),this.add(this.title),this.add(this.message),1!=a.noClose&&this.add(this.button),void 0==a.x&&void 0==a.y?this.position({x:WIDTH/2-a.width/2,y:HEIGHT/2-a.height/2}):this.position({x:a.x||0,y:a.y||0}),this.setDraggable(!0),this.close=function(){b.destroy(),a.layer.draw()},1!=a.noClose&&(this.button.onActivate=this.close),1==a.yesNo&&(this.option1.base.fill("#44FF44"),this.option1.text.setText(DIALOG.yes[LANGUAGE]),this.option1.refreshColors(),this.option2.base.fill("#FF4444"),this.option2.text.setText(DIALOG.no[LANGUAGE]),this.option2.refreshColors(),this.option2.onActivate=function(){b.close()}),this.base.on("mousedown touchstart",function(a){a.target.parent._onDown(),a.target.parent.onDown()}),void 0!=a.layer&&(a.layer.add(this),this.draw())};Pane.prototype=Object.create(Kinetic.Group.prototype),Pane.prototype.constructor=Pane,Pane.prototype.onDown=function(){},Pane.prototype._onDown=function(){this.moveToTop()};var fitImageFullscreen=function(a){var b=a.getWidth()/WIDTH,c=a.getHeight()/HEIGHT,d=1;d=c>b?WIDTH/a.getWidth():HEIGHT/a.getHeight(),a.scaleX(d),a.scaleY(d),a.position({x:WIDTH/2-a.getWidth()*d/2,y:HEIGHT/2-a.getHeight()*d/2})},fitImageMostScreen=function(a){var b=a.getWidth()/WIDTH,c=a.getHeight()/HEIGHT,d=1;d=c>b?HEIGHT/a.getHeight():WIDTH/a.getWidth(),a.scaleX(d),a.scaleY(d),a.position({x:WIDTH/2-a.getWidth()*d/2,y:HEIGHT/2-a.getHeight()*d/2})},shadeColor=function(a,b){a=colorNameToHex(a);var c=parseInt(a.substring(1,3),16),d=parseInt(a.substring(3,5),16),e=parseInt(a.substring(5,7),16);c=parseInt(c*(100+b)/100),d=parseInt(d*(100+b)/100),e=parseInt(e*(100+b)/100),c=255>c?c:255,d=255>d?d:255,e=255>e?e:255;var f=1==c.toString(16).length?"0"+c.toString(16):c.toString(16),g=1==d.toString(16).length?"0"+d.toString(16):d.toString(16),h=1==e.toString(16).length?"0"+e.toString(16):e.toString(16);return"#"+f+g+h},colorNameToHex=function(a){var b={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return"undefined"!=typeof b[a.toLowerCase()]?b[a.toLowerCase()]:a},roundTwoPlaces=function(a){return Math.round(100*a)/100};BACKGROUND=0,CHARACTER=void 0,MAX_CARRY_WEIGHT=25,CARRY_WEIGHT=0,FOOD=0,WATER=0,INVENTORY=void 0,STATUS=void 0,HUNGER=100,THIRST=100,TEMPERATURE=37,ENERGY=100,PESOS=0,QUETZALES=0,LEMPIRAS=0,US_DOLLARS=0,REGIONS={HONDURAS:"Honduras",SAN_SALVADOR:"San Salvador",GUATEMALA:"Guatemala",MEXICO:DIALOG.mexico[LANGUAGE],SONORAN_DESERT:DIALOG.sonoranDesert[LANGUAGE]},REGION=REGIONS.SONORAN_DESERT,BIOMES={DESERT:DIALOG.desert[LANGUAGE],SAVANNA:DIALOG.savanna[LANGUAGE],TROPICAL:DIALOG.tropical[LANGUAGE]},BIOME=BIOMES.DESERT,STEP_MAX={},STEP_MAX[REGIONS.HONDURAS]=290,STEP_MAX[REGIONS.EL_SALVADOR]=121,STEP_MAX[REGIONS.GUATEMALA]=511,STEP_MAX[REGIONS.MEXICO]=2576,STEP_MAX[REGIONS.SONORAN_DESERT]=756,STEP=0,BIOME_MARKERS={},BIOME_MARKERS[BIOMES.SAVANNA]=STEP_MAX[REGIONS.GUATEMALA]+1300,BIOME_MARKERS[BIOMES.DESERT]=STEP_MAX[REGIONS.GUATEMALA]+STEP_MAX[REGIONS.MEXICO],AILMENT_TYPES={BROKEN_LIMB:DIALOG.brokenLimb[LANGUAGE],TUBERCULOSIS:DIALOG.tuberculosis[LANGUAGE],SCABIES:DIALOG.scabies[LANGUAGE],DENGUE_FEVER:DIALOG.dengueFever[LANGUAGE],DEHYDRATION:DIALOG.dehydration[LANGUAGE],EXHAUSTION:DIALOG.exhaustion[LANGUAGE],SPRAIN:DIALOG.sprain[LANGUAGE],DIARRHEA:DIALOG.diarrhea[LANGUAGE],MALNUTRITION:DIALOG.malnutrition[LANGUAGE]},PERK_TYPES={OUTDOORSMAN:DIALOG.outdoorsman[LANGUAGE],LIGHTWEIGHT:DIALOG.lightweight[LANGUAGE]},AILMENTS=[],PERKS=[],DAYS=0,TIME_OF_DAY={DAY:DIALOG.day[LANGUAGE],NIGHT:DIALOG.night[LANGUAGE]},CYCLE=TIME_OF_DAY.DAY,ENVIRONMENTAL_TEMPERATURE=22,RESTING=!1,GAME_STARTED=!1,GROUND_COLOR="#b9aa65",REPORTED_TO_AUTHORITIES=!1,RIDING_LA_BESTIA=!1,WITH_COYOTE=!1;var initializePlayer=function(){REGIONS={HONDURAS:"Honduras",EL_SALVADOR:"El Salvador",GUATEMALA:"Guatemala",MEXICO:DIALOG.mexico[LANGUAGE],SONORAN_DESERT:DIALOG.sonoranDesert[LANGUAGE]},REGION=REGIONS.SONORAN_DESERT,ORIGIN=REGIONS.HONDURAS,BIOMES={DESERT:DIALOG.desert[LANGUAGE],SAVANNA:DIALOG.savanna[LANGUAGE],TROPICAL:DIALOG.tropical[LANGUAGE]},BIOME=BIOMES.TROPICAL,BIOME_MARKERS[BIOMES.SAVANNA]=STEP_MAX[REGIONS.GUATEMALA]+1300,BIOME_MARKERS[BIOMES.DESERT]=STEP_MAX[REGIONS.GUATEMALA]+STEP_MAX[REGIONS.MEXICO],STEP_MAX[REGIONS.HONDURAS]=290,STEP_MAX[REGIONS.EL_SALVADOR]=121,STEP_MAX[REGIONS.GUATEMALA]=511,STEP_MAX[REGIONS.MEXICO]=2576,STEP_MAX[REGIONS.SONORAN_DESERT]=756,AILMENT_TYPES={BROKEN_LIMB:DIALOG.brokenLimb[LANGUAGE],TUBERCULOSIS:DIALOG.tuberculosis[LANGUAGE],SCABIES:DIALOG.scabies[LANGUAGE],DENGUE_FEVER:DIALOG.dengueFever[LANGUAGE],DEHYDRATION:DIALOG.dehydration[LANGUAGE],EXHAUSTION:DIALOG.exhaustion[LANGUAGE],SPRAIN:DIALOG.sprain[LANGUAGE],DIARRHEA:DIALOG.diarrhea[LANGUAGE],MALNUTRITION:DIALOG.malnutrition[LANGUAGE]},PERK_TYPES={OUTDOORSMAN:DIALOG.outdoorsman[LANGUAGE],LIGHTWEIGHT:DIALOG.lightweight[LANGUAGE]},TIME_OF_DAY={DAY:DIALOG.day[LANGUAGE],NIGHT:DIALOG.night[LANGUAGE]},CYCLE=TIME_OF_DAY.DAY},inTransition=function(){},nextCycle=function(){},triggerEvent=function(a){var b=PROBABILITIES[a][1]();b||console.log("FAILURE: EVENT REQUIREMENTS NOT MET.")},getLocalPrice=function(a){switch(REGION){case REGIONS.HONDURAS:return roundTwoPlaces(21*a);case REGIONS.GUATEMALA:return roundTwoPlaces(7.65*a);case REGIONS.MEXICO:return roundTwoPlaces(14.57*a);case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:return roundTwoPlaces(a)}},getLocalWallet=function(){switch(REGION){case REGIONS.HONDURAS:return LEMPIRAS;case REGIONS.GUATEMALA:return QUETZALES;case REGIONS.MEXICO:return PESOS;case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:return US_DOLLARS}},getLocalSign=function(){switch(REGION){case REGIONS.HONDURAS:return"L";case REGIONS.GUATEMALA:return"Q";case REGIONS.MEXICO:case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:return"$"}},getLocalAccronym=function(){switch(REGION){case REGIONS.HONDURAS:return"HNL";case REGIONS.GUATEMALA:return"GTQ";case REGIONS.MEXICO:return"MXN";case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:return"USD"}},setLocalWallet=function(a){switch(REGION){case REGIONS.HONDURAS:LEMPIRAS=a;break;case REGIONS.GUATEMALA:QUETZALES=a;break;case REGIONS.MEXICO:PESOS=a;break;case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:US_DOLLARS=a}},getLocalDisplayPrice=function(a){switch(REGION){case REGIONS.HONDURAS:return a+" HNL";case REGIONS.GUATEMALA:return a+" GTQ";case REGIONS.MEXICO:return a+" MXN";case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:return a+" USD"}},updateGroundColor=function(){switch(BIOME){case BIOMES.TROPICAL:GROUND_COLOR="#388a47";break;case BIOMES.SAVANNA:GROUND_COLOR="#b9aa65";break;case BIOMES.DESERT:GROUND_COLOR="#eba581"}},updateRegions=function(){ORIGIN==REGIONS.EL_SALVADOR||ORIGIN==REGIONS.HONDURAS?((REGION==REGIONS.HONDURAS||REGION==REGIONS.EL_SALVADOR)&&STEP>=STEP_MAX[REGION]?(REGION=REGIONS.GUATEMALA,new Pane({message:DIALOG.regionGuatemala[LANGUAGE],title:"GUATEMALA",layer:ui})):REGION==REGIONS.GUATEMALA&&STEP>=STEP_MAX[REGION]+STEP_MAX[ORIGIN]?(REGION=REGIONS.MEXICO,new Pane({message:DIALOG.regionMexico[LANGUAGE],title:DIALOG.mexico[LANGUAGE],layer:ui})):REGION==REGIONS.MEXICO&&STEP>=STEP_MAX[REGION]+STEP_MAX[REGIONS.GUATEMALA]+STEP_MAX[ORIGIN]?(REGION=REGIONS.SONORAN_DESERT,new Pane({message:DIALOG.regionSonora[LANGUAGE],title:DIALOG.sonoranDesert[LANGUAGE],layer:ui})):REGION==REGIONS.SONORAN_DESERT&&STEP>=STEP_MAX[REGION]+STEP_MAX[REGIONS.MEXICO]+STEP_MAX[REGIONS.GUATEMALA]+STEP_MAX[ORIGIN]&&win(),BIOME=STEP>=BIOME_MARKERS[BIOMES.DESERT]+STEP_MAX[ORIGIN]?BIOMES.DESERT:STEP>=BIOME_MARKERS[BIOMES.SAVANNA]+STEP_MAX[ORIGIN]?BIOMES.SAVANNA:BIOMES.TROPICAL):ORIGIN==REGIONS.GUATEMALA?(REGION==REGIONS.GUATEMALA&&STEP>=STEP_MAX[REGION]?(REGION=REGIONS.MEXICO,new Pane({message:DIALOG.regionMexico[LANGUAGE],title:DIALOG.mexico[LANGUAGE],layer:ui})):REGION==REGIONS.MEXICO&&STEP>=STEP_MAX[REGION]+STEP_MAX[ORIGIN]?(REGION=REGIONS.SONORAN_DESERT,new Pane({message:DIALOG.regionSonora[LANGUAGE],title:DIALOG.sonoranDesert[LANGUAGE],layer:ui})):REGION==REGIONS.SONORAN_DESERT&&STEP>=STEP_MAX[REGION]+STEP_MAX[REGIONS.MEXICO]+STEP_MAX[ORIGIN]&&win(),BIOME=STEP>=BIOME_MARKERS[BIOMES.DESERT]?BIOMES.DESERT:STEP>=BIOME_MARKERS[BIOMES.SAVANNA]?BIOMES.SAVANNA:BIOMES.TROPICAL):ORIGIN==REGIONS.MEXICO&&(REGION==REGIONS.MEXICO&&STEP>=STEP_MAX[REGION]?(REGION=REGIONS.SONORAN_DESERT,new Pane({message:DIALOG.regionSonora[LANGUAGE],title:DIALOG.sonoranDesert[LANGUAGE],layer:ui})):REGION==REGIONS.SONORAN_DESERT&&STEP>=STEP_MAX[REGION]+STEP_MAX[ORIGIN]&&win(),BIOME=STEP>=BIOME_MARKERS[BIOMES.DESERT]-STEP_MAX[REGIONS.GUATEMALA]?BIOMES.DESERT:STEP>=BIOME_MARKERS[BIOMES.SAVANNA]-STEP_MAX[REGIONS.GUATEMALA]?BIOMES.SAVANNA:BIOMES.TROPICAL),updateGroundColor(),updateStatus()},removeEffect=function(a){var b;if(-1!=AILMENTS.indexOf(a))switch(b=AILMENTS,a){case AILMENT_TYPES.BROKEN_LIMB:new Pane({message:DIALOG.loseBrokenLimb[LANGUAGE],title:DIALOG.brokenLimb[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.TUBERCULOSIS:new Pane({message:DIALOG.loseTuberculosis[LANGUAGE],title:DIALOG.tuberculosis[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.SCABIES:new Pane({message:DIALOG.loseScabies[LANGUAGE],title:DIALOG.scabies[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.DENGUE_FEVER:new Pane({message:DIALOG.loseDengueFever[LANGUAGE],title:DIALOG.dengueFever[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.DEHYDRATION:new Pane({message:DIALOG.loseDehydration[LANGUAGE],title:DIALOG.dehydration[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.EXHAUSTION:new Pane({message:DIALOG.loseExhaustion[LANGUAGE],title:DIALOG.exhaustion[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.SPRAIN:new Pane({message:DIALOG.loseSprain[LANGUAGE],title:DIALOG.sprain[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.DIARRHEA:new Pane({message:DIALOG.loseDiarrhea[LANGUAGE],title:DIALOG.diarrhea[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.MALNUTRITION:new Pane({message:DIALOG.loseMalnourishment[LANGUAGE],title:DIALOG.malnutrition[LANGUAGE].toUpperCase(),layer:ui})}else-1!=PERKS.indexOf(a)&&(b=PERKS);if(null!=b||void 0!=b){var c=b.indexOf(a);-1!=c&&b.splice(c,1)}updateStatus()},addEffect=function(a,b){if(!hasEffect(a))switch(b.push(a),a){case AILMENT_TYPES.BROKEN_LIMB:new Pane({message:DIALOG.gainBrokenLimb[LANGUAGE],title:DIALOG.brokenLimb[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.TUBERCULOSIS:new Pane({message:DIALOG.gainTuberculosis[LANGUAGE],title:DIALOG.tuberculosis[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.SCABIES:new Pane({message:DIALOG.gainScabies[LANGUAGE],title:DIALOG.scabies[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.DENGUE_FEVER:new Pane({message:DIALOG.gainDengueFever[LANGUAGE],title:DIALOG.dengueFever[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.DEHYDRATION:new Pane({message:DIALOG.gainDehydration[LANGUAGE],title:DIALOG.dehydration[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.EXHAUSTION:new Pane({message:DIALOG.gainExhaustion[LANGUAGE],title:DIALOG.exhaustion[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.SPRAIN:new Pane({message:DIALOG.gainSprain[LANGUAGE],title:DIALOG.sprain[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.DIARRHEA:new Pane({message:DIALOG.gainDiarrhea[LANGUAGE],title:DIALOG.diarrhea[LANGUAGE].toUpperCase(),layer:ui});break;case AILMENT_TYPES.MALNUTRITION:new Pane({message:DIALOG.gainMalnourishment[LANGUAGE],title:DIALOG.malnutrition[LANGUAGE].toUpperCase(),layer:ui})}updateStatus()},hasEffect=function(a){return-1!=AILMENTS.indexOf(a)?!0:-1!=PERKS.indexOf(a)?!0:!1},arrayToString=function(a){for(var b="",c=0;c<a.length;c++)(void 0!=a[c]||null!=a[c])&&(b+=a[c],c!=a.length-1&&(b+=", "));return(0==a.length||void 0==a)&&(b=DIALOG.none[LANGUAGE]),b},updateInventory=function(){void 0!=INVENTORY&&null!=INVENTORY.parent&&(INVENTORY.message.setText(DIALOG.carryWeight[LANGUAGE]+": \n"+DIALOG.food[LANGUAGE]+": \n"+DIALOG.water[LANGUAGE]+": \n\n"+DIALOG.usdollar[LANGUAGE]+": \n"+DIALOG.mexicanPeso[LANGUAGE]+": \n"+DIALOG.guatemalanQuetzal[LANGUAGE]+": \n"+DIALOG.honduranLempira[LANGUAGE]+": \n"),INVENTORY.values.setText(roundTwoPlaces(FOOD+WATER)+" / "+MAX_CARRY_WEIGHT+" kg\n"+roundTwoPlaces(FOOD)+" kg\n"+roundTwoPlaces(WATER)+" L\n\n"+"$ "+roundTwoPlaces(US_DOLLARS)+"\n"+"$ "+roundTwoPlaces(PESOS)+"\n"+"Q "+roundTwoPlaces(QUETZALES)+"\n"+"L "+roundTwoPlaces(LEMPIRAS)+"\n"),INVENTORY.draw())},openInventory=function(){void 0==INVENTORY||null==INVENTORY.parent?(INVENTORY=new Pane({width:250,height:150,center:!1,title:DIALOG.inventory[LANGUAGE].toUpperCase(),layer:ui}),INVENTORY.values=INVENTORY.message.clone(),INVENTORY.values.setAttr("align","right"),INVENTORY.add(INVENTORY.values),updateInventory()):updateInventory()},updateStatus=function(){if(void 0!=STATUS&&null!=STATUS.parent){var a="";a=WITH_COYOTE?DIALOG.coyote[LANGUAGE]:RIDING_LA_BESTIA?DIALOG.laBestia[LANGUAGE]:DIALOG.walking[LANGUAGE],STATUS.message.setText(DIALOG.distanceTraveled[LANGUAGE]+": \n"+DIALOG.region[LANGUAGE]+": \n"+DIALOG.biome[LANGUAGE]+": \n"+DIALOG.environmentalTemperature[LANGUAGE]+": \n"+DIALOG.modeOfTravel[LANGUAGE]+": \n"+DIALOG.day[LANGUAGE]+"s: \n"+DIALOG.perks[LANGUAGE]+": "+arrayToString(PERKS)+"\n"+DIALOG.ailments[LANGUAGE]+": "+arrayToString(AILMENTS)+"\n"),STATUS.values.setText(roundTwoPlaces(STEP)+" km\n"+REGION+"\n"+BIOME+"\n"+roundTwoPlaces(ENVIRONMENTAL_TEMPERATURE)+" °C\n"+a+"\n"+DAYS+"\n"),STATUS.draw()}},openStatus=function(){void 0==STATUS||null==STATUS.parent?(STATUS=new Pane({width:300,height:175,center:!1,title:DIALOG.status[LANGUAGE].toUpperCase(),layer:ui}),STATUS.values=STATUS.message.clone(),STATUS.values.setAttr("align","right"),STATUS.add(STATUS.values),updateStatus()):updateStatus()},die=function(a){var b=new Kinetic.Rect({width:WIDTH,height:HEIGHT,x:0,y:0,fill:"#884444",opacity:.5});ui.add(b);var c=new Pane({width:300,height:125,message:a,title:DIALOG.gameOver[LANGUAGE].toUpperCase(),center:!0,noClose:!0,buttons:1,layer:ui});c.option1.base.fill("red"),c.option1.refreshColors(),c.option1.text.setText(DIALOG.quit[LANGUAGE]),CHARACTER.stop(),c.option1.onActivate=function(){location.reload()},b.draw(),c.draw()},win=function(){var a=new Kinetic.Layer({}),b=new Kinetic.Image({image:IMAGES["winBackground.jpg"],x:0,y:0});fitImageFullscreen(b),a.add(b);var c=new Button({width:125,height:75,text:DIALOG.quit[LANGUAGE].toUpperCase(),fill:"#44FF44",fontSize:30,x:WIDTH-135,y:HEIGHT-85,layer:a});new Annotation({width:150,height:75,text:DIALOG.score[LANGUAGE]+": 123456",fontSize:20,x:10,y:HEIGHT-85,layer:a});var e=new Kinetic.Text({text:DIALOG.winTitle[LANGUAGE],fontSize:40,x:10,y:10,align:"center",fill:"black",fontStyle:"bold"});e.setWidth(WIDTH-20),e.setHeight(100),e.position({y:HEIGHT/3-e.getHeight()/2}),a.add(e),STAGE.add(a),c.onActivate=function(){location.reload()}},loadingMenu=function(){var a=new Kinetic.Layer({}),b=new Kinetic.Text({text:"LOADING...",fontSize:50,x:50,y:50,fill:"white",fontStyle:"bold"});b.setWidth(b.getTextWidth()),b.setHeight(b.getTextHeight()),b.position({x:WIDTH/2-b.getWidth()/2,y:HEIGHT/2-b.getHeight()/2});var c=new Kinetic.Rect({width:0,height:25,x:WIDTH/2-b.getWidth()/2,y:HEIGHT/2-12.5+b.getHeight()+50,fill:"white"}),d=new Kinetic.Text({fill:"#888888",text:"0%",fontSize:20});d.setWidth(d.getTextWidth()),d.setHeight(d.getTextHeight()),d.position({x:WIDTH/2-d.getTextWidth()/2,y:c.getAttr("y")+c.getHeight()/2-d.getHeight()/2}),a.add(b),a.add(c),a.add(d),STAGE.add(a),STAGE.draw();var e=function(){setTimeout(function(){imageCount>loadedImageCount?(c.setWidth(loadedImageCount/imageCount*b.getWidth()),d.setText(Math.round(100*(loadedImageCount/imageCount))+"%"),d.setWidth(c.getWidth()),d.position({x:WIDTH/2-d.getTextWidth()/2,y:c.getAttr("y")+c.getHeight()/2-d.getHeight()/2}),STAGE.draw(),e()):(a.destroy(),HEIGHT>WIDTH?recommendTurnScreen():titleMenu())},250)};e()}(),recommendTurnScreen=function(){var a=new Kinetic.Layer({fill:"black"}),b=new Kinetic.Text({width:WIDTH,height:HEIGHT,align:"center",text:"Landscape mode is recommended\n\nWait 5 seconds to ignore...",fill:"white",fontSize:20}),c=b.getTextHeight()*b.attrs.text.split("\n").length;b.offsetY(-1*HEIGHT/2+c/2),a.add(b),STAGE.add(a);var d=0,e=function(){setTimeout(function(){d>=5e3?(a.destroy(),titleMenu()):WIDTH>HEIGHT?(a.destroy(),titleMenu()):(d+=250,e())},250)};e()},titleMenu=function(){var a=new Kinetic.Layer({}),b=new Kinetic.Image({image:IMAGES["titleBackground.jpg"],x:0,y:0});fitImageFullscreen(b),a.add(b);var c=new Button({width:200,height:75,text:"ENGLISH",fill:"#44FF44",fontSize:30,y:HEIGHT/2+50-50-37.5,layer:a}),d=new Button({width:200,height:75,text:"ESPAÑOL",fill:"#FF4444",fontSize:30,y:HEIGHT/2+50+50-37.5,layer:a}),e=new Kinetic.Text({text:"MIGRANT",fontSize:50,x:50,y:50,fill:"black",fontStyle:"bold"});e.setWidth(e.getTextWidth()),e.setHeight(e.getTextHeight()),e.position({x:WIDTH/2-e.getWidth()/2,y:HEIGHT/2-e.getHeight()/2-100}),a.add(e),STAGE.add(a),c.onActivate=function(){LANGUAGE=0,initializePlayer(),a.destroy(),backgroundMenu(),STAGE.draw()},d.onActivate=function(){LANGUAGE=1,initializePlayer(),a.destroy(),backgroundMenu(),STAGE.draw()}},backgroundMenu=function(){var a=new Kinetic.Layer({}),b=new Button({width:50,height:(HEIGHT-10)/5,x:5,y:0*((HEIGHT-10)/5)+5,text:"1",fontSize:30,layer:a}),c=new Button({width:50,height:(HEIGHT-10)/5,x:5,y:1*((HEIGHT-10)/5)+5,text:"2",fontSize:30,layer:a}),d=new Button({width:50,height:(HEIGHT-10)/5,x:5,y:2*((HEIGHT-10)/5)+5,text:"3",fontSize:30,layer:a}),e=new Button({width:50,height:(HEIGHT-10)/5,x:5,y:3*((HEIGHT-10)/5)+5,text:"4",fontSize:30,layer:a}),f=new Button({width:50,height:(HEIGHT-10)/5,x:5,y:4*((HEIGHT-10)/5)+5,text:"5",fontSize:30,layer:a}),g=function(g){b.base.setAttrs({stroke:"black",strokeWidth:1}),c.base.setAttrs({stroke:"black",strokeWidth:1}),d.base.setAttrs({stroke:"black",strokeWidth:1}),e.base.setAttrs({stroke:"black",strokeWidth:1}),f.base.setAttrs({stroke:"black",strokeWidth:1}),g.base.setAttrs({stroke:"red",strokeWidth:3}),g.moveToTop(),a.draw()};b.onActivate=function(){i.message.text(DIALOG.background1[LANGUAGE]),g(this),BACKGROUND=1},c.onActivate=function(){i.message.text(DIALOG.background2[LANGUAGE]),g(this),BACKGROUND=2},d.onActivate=function(){i.message.text(DIALOG.background3[LANGUAGE]),g(this),BACKGROUND=3},e.onActivate=function(){i.message.text(DIALOG.background4[LANGUAGE]),g(this),BACKGROUND=4},f.onActivate=function(){i.message.text(DIALOG.background5[LANGUAGE]),g(this),BACKGROUND=5};var h=new Button({width:150,height:50,fill:"#44FF44",text:DIALOG.continue[LANGUAGE],x:WIDTH-160,y:HEIGHT-60});h.onActivate=function(){switch(BACKGROUND){case 1:REGION=REGIONS.EL_SALVADOR,ORIGIN=REGIONS.EL_SALVADOR,US_DOLLARS=440;break;case 2:REGION=REGIONS.MEXICO,ORIGIN=REGIONS.MEXICO,PESOS=6500,AILMENTS.push(AILMENT_TYPES.BROKEN_LIMB);break;case 3:REGION=REGIONS.HONDURAS,ORIGIN=REGIONS.HONDURAS,LEMPIRAS=9850,PERKS.push(PERK_TYPES.OUTDOORSMAN);break;case 4:REGION=REGIONS.GUATEMALA,ORIGIN=REGIONS.GUATEMALA,QUETZALES=3e3,AILMENTS.push(AILMENT_TYPES.TUBERCULOSIS);break;case 5:REGION=REGIONS.EL_SALVADOR,ORIGIN=REGIONS.EL_SALVADOR,US_DOLLARS=400,PERKS.push(PERK_TYPES.LIGHTWEIGHT)}updateGroundColor(),storeMenu(),a.destroy()};var i=new Pane({width:WIDTH-10-50,height:HEIGHT-10,x:55,y:5,title:DIALOG.backgroundTitle[LANGUAGE],center:!1});i.button.destroy(),i.setDraggable(!1),i._onDown=function(){},a.add(b),a.add(c),a.add(d),a.add(e),a.add(f),a.add(i),a.add(h),STAGE.add(a),b.onActivate()},storeMenu=function(){var a=new Kinetic.Layer({}),b=new Kinetic.Rect({width:WIDTH,height:HEIGHT,x:0,y:0,fill:"black"});a.add(b),new Annotation({width:100,height:50,x:WIDTH-100-10,y:10,fontSize:30,text:DIALOG.store[LANGUAGE],layer:a,fill:"black",fontColor:"white"});var d;d=0==GAME_STARTED?new Button({width:100,height:50,x:WIDTH-100-10,y:HEIGHT-50-10,text:DIALOG.embark[LANGUAGE],layer:a,fill:"#44FF44"}):new Button({width:100,height:50,x:WIDTH-100-10,y:HEIGHT-50-10,text:DIALOG.leave[LANGUAGE],layer:a,fill:"#44FF44"});var e=function(a){switch(REGION){case REGIONS.HONDURAS:return roundTwoPlaces(21*a);case REGIONS.GUATEMALA:return roundTwoPlaces(7.65*a);case REGIONS.MEXICO:return roundTwoPlaces(14.57*a);case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:return a}},f=function(){switch(REGION){case REGIONS.HONDURAS:return LEMPIRAS;case REGIONS.GUATEMALA:return QUETZALES;case REGIONS.MEXICO:return PESOS;case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:return US_DOLLARS}},g=function(a){switch(REGION){case REGIONS.HONDURAS:LEMPIRAS=a;break;case REGIONS.GUATEMALA:QUETZALES=a;break;case REGIONS.MEXICO:PESOS=a;break;case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:US_DOLLARS=a}},i=function(){switch(REGION){case REGIONS.HONDURAS:return"HNL";case REGIONS.GUATEMALA:return"GTQ";case REGIONS.MEXICO:return"MXN";case REGIONS.SONORAN_DESERT:case REGIONS.EL_SALVADOR:default:return"USD"}},j=1*Math.random()+1.5,k=Math.random()*(.7-.3)+.3,l=function(){B.text.setText(DIALOG.usdollar[LANGUAGE]+"\n"+roundTwoPlaces(US_DOLLARS)+" USD"),v.text.setText(DIALOG.honduranLempira[LANGUAGE]+"\n"+roundTwoPlaces(LEMPIRAS)+" HNL"),x.text.setText(DIALOG.guatemalanQuetzal[LANGUAGE]+"\n"+roundTwoPlaces(QUETZALES)+" GTQ"),z.text.setText(DIALOG.mexicanPeso[LANGUAGE]+"\n"+roundTwoPlaces(PESOS)+" MXN"),o.text.setText(DIALOG.water[LANGUAGE]+": "+roundTwoPlaces(e(k))+" "+i()+"\n"+roundTwoPlaces(WATER)+"L"),r.text.setText(DIALOG.food[LANGUAGE]+": "+roundTwoPlaces(e(j))+" "+i()+"\n"+roundTwoPlaces(FOOD)+"kg"),a.draw()},m=(HEIGHT-60)/5,n=3*((WIDTH-50)/8),o=new Annotation({x:10,y:0*m+10,height:m,width:n,text:DIALOG.water[LANGUAGE]+": "+e(k)+" "+i()+"\n"+roundTwoPlaces(WATER)+"L",layer:a}),p=new Button({x:o.base.getWidth()+20,y:10,width:n/3,height:m/2,fill:"green",text:"+ 1L",layer:a}),q=new Button({x:o.base.getWidth()+20,y:p.base.getHeight()+10,width:n/3,height:m/2,fill:"red",text:"- 1L",layer:a}),r=new Annotation({x:10,y:1*m+20,height:m,width:n,text:DIALOG.food[LANGUAGE]+": "+e(j)+" "+i()+"\n"+roundTwoPlaces(FOOD)+"kg",layer:a}),s=new Button({x:r.base.getWidth()+20,y:r.getAttr("y"),width:n/3,height:m/2,fill:"green",text:"+ 1kg",layer:a}),t=new Button({x:r.base.getWidth()+20,y:r.getAttr("y")+s.base.getHeight(),width:n/3,height:m/2,fill:"red",text:"- 1kg",layer:a}),u=null;p.onActivate=function(){f()>=e(k)&&MAX_CARRY_WEIGHT>FOOD+WATER&&(g(f()-e(k)),WATER++,l()),FOOD+WATER>=MAX_CARRY_WEIGHT&&(null==u||void 0==u||null==u.parent)&&(null==u||void 0==u?u=new Pane({message:DIALOG.overEncumbered[LANGUAGE],center:!0,height:100,width:200,layer:a}):null==u.parent&&(u=null,u=new Pane({message:DIALOG.overEncumbered[LANGUAGE],center:!0,height:100,width:200,layer:a})))},q.onActivate=function(){WATER>0&&(g(f()+e(k)),WATER--,l())},s.onActivate=function(){f()>=e(j)&&MAX_CARRY_WEIGHT>FOOD+WATER&&(g(f()-e(j)),FOOD++,l()),FOOD+WATER>=MAX_CARRY_WEIGHT&&(null==u||void 0==u||null==u.parent)&&(null==u||void 0==u?u=new Pane({message:DIALOG.overEncumbered[LANGUAGE],center:!0,height:100,width:200,layer:a}):null==u.parent&&(u=null,u=new Pane({message:DIALOG.overEncumbered[LANGUAGE],center:!0,height:100,width:200,layer:a})))},t.onActivate=function(){FOOD>0&&(g(f()+e(j)),FOOD--,l())};var v=new Annotation({x:10,y:4*((HEIGHT-60)/5)+50,width:n,height:m,text:DIALOG.honduranLempira[LANGUAGE]+"\n"+roundTwoPlaces(LEMPIRAS)+" HNL",layer:a}),w=new Button({x:v.getAttr("x")+v.getWidth()+10,y:v.getAttr("y"),width:n/3,height:m,text:DIALOG.to[LANGUAGE]+" USD",fill:"green",layer:a}),x=new Annotation({x:10,y:v.getAttr("y")-(10+m),width:n,height:m,text:DIALOG.guatemalanQuetzal[LANGUAGE]+"\n"+roundTwoPlaces(QUETZALES)+" GTQ",layer:a}),y=new Button({x:x.getAttr("x")+x.getWidth()+10,y:x.getAttr("y"),width:n/3,height:m,text:DIALOG.to[LANGUAGE]+" USD",fill:"green",layer:a}),z=new Annotation({x:10,y:x.getAttr("y")-(10+m),width:n,height:m,text:DIALOG.mexicanPeso[LANGUAGE]+"\n"+roundTwoPlaces(PESOS)+" MXN",layer:a}),A=new Button({x:z.getAttr("x")+z.getWidth()+10,y:z.getAttr("y"),width:n/3,height:m,text:DIALOG.to[LANGUAGE]+" USD",fill:"green",layer:a}),B=new Annotation({x:40+n+2*(n/3),y:x.getAttr("y"),width:n,height:m,text:DIALOG.usdollar[LANGUAGE]+"\n"+roundTwoPlaces(US_DOLLARS)+" USD",layer:a}),C=new Button({x:z.getAttr("x")+z.getWidth()+A.getWidth()+20,y:z.getAttr("y"),width:n/3,height:m,text:DIALOG.to[LANGUAGE]+" MXN",fill:"blue",layer:a}),D=new Button({x:x.getAttr("x")+x.getWidth()+y.getWidth()+20,y:x.getAttr("y"),width:n/3,height:m,text:DIALOG.to[LANGUAGE]+" GTQ",fill:"yellow",layer:a}),E=new Button({x:v.getAttr("x")+v.getWidth()+w.getWidth()+20,y:v.getAttr("y"),width:n/3,height:m,text:DIALOG.to[LANGUAGE]+" HNL",fill:"red",layer:a});l();var F=function(a,b,c,d){d=d||10;var e=0;return a>=d?(a-=d,e+=d):(e=a,a=0),b+=e*c,[a,b]};w.onActivate=function(){var a=F(LEMPIRAS,US_DOLLARS,1/21,210);LEMPIRAS=a[0],US_DOLLARS=a[1],l()},E.onActivate=function(){var a=F(US_DOLLARS,LEMPIRAS,21,10);US_DOLLARS=a[0],LEMPIRAS=a[1],l()},y.onActivate=function(){var a=F(QUETZALES,US_DOLLARS,1/7.65,77);QUETZALES=a[0],US_DOLLARS=a[1],l()},D.onActivate=function(){var a=F(US_DOLLARS,QUETZALES,7.65,10);US_DOLLARS=a[0],QUETZALES=a[1],l()},A.onActivate=function(){var a=F(PESOS,US_DOLLARS,1/14.57,150);
    PESOS=a[0],US_DOLLARS=a[1],l()},C.onActivate=function(){var a=F(US_DOLLARS,PESOS,14.57,10);US_DOLLARS=a[0],PESOS=a[1],l()},d.onActivate=0==GAME_STARTED?function(){GAME_STARTED=!0,a.destroy(),main()}:function(){a.destroy()},STAGE.add(a),STAGE.draw()},main=function(){var a=new Kinetic.Rect({x:0,y:0,width:WIDTH,height:HEIGHT,fill:"#a8d8fc"});fitImageFullscreen(a);for(var b=new Kinetic.Rect({x:0,y:2*(HEIGHT/3),width:WIDTH,height:HEIGHT/3,fill:GROUND_COLOR}),c=new Kinetic.Group({width:WIDTH+HEIGHT/3,height:HEIGHT,x:-1*HEIGHT/3,y:-1*HEIGHT/3}),d=0;200>d;d++){var e=new Kinetic.Star({x:Math.random()*c.getWidth(),y:Math.random()*c.getHeight(),numPoints:Math.round(4*Math.random()+4),innerRadius:1.5*Math.random(),outerRadius:4*Math.random()+1,fill:"rgb("+Math.round(63*Math.random()+192)+", "+Math.round(63*Math.random()+192)+", "+Math.round(63*Math.random()+192)+")"});e.angularSpeed=1*Math.random()-.5,c.add(e)}CHARACTER=new Kinetic.Sprite({width:150,height:250,x:0,y:0,image:IMAGES["walkingMan.png"],animation:"walking",animations:{walking:[0,0,150,250,0,250,150,250,0,500,150,250,0,750,150,250],idle:[0,1e3,150,250]},frameRate:5,frameIndex:0}),CHARACTER.scaleX(.25*HEIGHT/CHARACTER.getHeight()),CHARACTER.scaleY(.25*HEIGHT/CHARACTER.getHeight()),CHARACTER.setWidth(150*CHARACTER.scaleX()),CHARACTER.setHeight(250*CHARACTER.scaleY()),CHARACTER.position({x:WIDTH/2-CHARACTER.getWidth()/2,y:4*(HEIGHT/6)-CHARACTER.getHeight()/2});var f=new Button({text:DIALOG.inventory[LANGUAGE],width:100,height:50,x:WIDTH-100-10,y:HEIGHT-50-10,layer:ui});f.onActivate=function(){openInventory()};var g=new Button({text:DIALOG.status[LANGUAGE],width:75,height:50,x:f.x()-75-10,y:HEIGHT-50-10,layer:ui});g.onActivate=function(){openStatus()};var h=new Button({text:DIALOG.map[LANGUAGE],width:50,height:50,x:g.x()-50-10,y:f.y(),layer:ui});h.onActivate=function(){var a=new Kinetic.Layer({}),b=new Kinetic.Rect({width:WIDTH,height:HEIGHT,fill:"black"});a.add(b);var c=new Kinetic.Image({image:IMAGES["map.jpg"],x:0,y:0});fitImageMostScreen(c),a.add(c);var d=new Button({text:DIALOG.close[LANGUAGE],width:100,height:50,x:WIDTH-100-10,y:10,layer:a});d.onActivate=function(){a.destroy()},STAGE.add(a),STAGE.draw()};var i=new Kinetic.Rect({width:150,height:20,x:10,y:HEIGHT-20-10,fill:"#CC4444"}),j=new Kinetic.Text({width:150,height:15,x:10,y:HEIGHT-20+5-10,fill:"black",text:DIALOG.hunger[LANGUAGE],align:"center"}),k=new Button({x:10,y:10,width:50,height:50,fill:"red",text:DIALOG.eat[LANGUAGE],layer:ui}),l=new Kinetic.Rect({width:150,height:20,x:10,y:HEIGHT-40-15,fill:"#4444CC"}),m=new Kinetic.Text({width:150,height:15,x:10,y:HEIGHT-40+5-15,fill:"black",text:DIALOG.thirst[LANGUAGE],align:"center"}),n=new Button({x:70,y:10,width:50,height:50,fill:"blue",text:DIALOG.drink[LANGUAGE],layer:ui}),o=new Kinetic.Rect({width:150,height:20,x:10,y:HEIGHT-60-20,fill:"#DDDD44"}),p=new Kinetic.Text({width:150,height:15,x:10,y:HEIGHT-60+5-20,fill:"black",text:DIALOG.energy[LANGUAGE],align:"center"}),q=new Kinetic.Rect({width:75,height:20,x:10,y:HEIGHT-80-25,fill:"#44CC44"}),r=new Kinetic.Text({width:150,height:15,x:10,y:HEIGHT-80+5-25,fill:"black",text:DIALOG.temperature[LANGUAGE],align:"center"}),s=50;1==LANGUAGE&&(s=75);var t=new Button({x:130,y:10,width:s,height:50,fill:"yellow",text:DIALOG.rest[LANGUAGE],layer:ui}),u=new Kinetic.Line({x:0,y:0,points:[160,HEIGHT-80-25,160,HEIGHT-10],stroke:"black",strokeWidth:1,tension:1}),v=new Button({x:WIDTH-100-10,y:10,text:DIALOG.nextDay[LANGUAGE],fill:"#44FF44",layer:ui});ui.add(i),ui.add(j),ui.add(l),ui.add(m),ui.add(o),ui.add(p),ui.add(q),ui.add(r),ui.add(u),updateBars=function(){0>=HUNGER?(i.setWidth(0),die(DIALOG.diedOfHunger[LANGUAGE])):(25>HUNGER?addEffect(AILMENT_TYPES.MALNUTRITION,AILMENTS):HUNGER>=25&&removeEffect(AILMENT_TYPES.MALNUTRITION),i.setWidth(150*(Math.min(HUNGER,100)/100))),0>=THIRST?(l.setWidth(0),die(DIALOG.diedOfThirst[LANGUAGE])):(25>THIRST?addEffect(AILMENT_TYPES.DEHYDRATION,AILMENTS):THIRST>=25&&removeEffect(AILMENT_TYPES.DEHYDRATION),l.setWidth(150*(Math.min(THIRST,100)/100))),0>=ENERGY?(o.setWidth(0),Math.random()>.5?die(DIALOG.diedOfExhaustion[LANGUAGE]):die(DIALOG.diedOfHeartAttack[LANGUAGE])):(25>ENERGY?addEffect(AILMENT_TYPES.EXHAUSTION,AILMENTS):ENERGY>=25&&removeEffect(AILMENT_TYPES.EXHAUSTION),o.setWidth(150*(Math.min(ENERGY,100)/100))),32>=TEMPERATURE?(q.setWidth(0),q.fill("#4488CC"),die(DIALOG.diedOfHypothermia[LANGUAGE])):TEMPERATURE>=42?(q.setWidth(150),q.fill("#CC8844"),die(DIALOG.diedOfHyperthermia[LANGUAGE])):(q.setWidth(150*((TEMPERATURE-32)/10)),TEMPERATURE>=39?q.fill("#CC8844"):35>=TEMPERATURE?q.fill("#4488CC"):q.fill("#44CC44")),ui.draw()},updateBars(),k.onActivate=function(){FOOD>=1.8?(FOOD-=1.8,HUNGER=Math.min(HUNGER+14.3,100)):FOOD>0?(HUNGER=Math.min(HUNGER+14.3*(FOOD/1.8),100),FOOD=0):new Pane({title:DIALOG.food[LANGUAGE].toUpperCase(),message:DIALOG.outOfFood[LANGUAGE],center:!0,layer:ui}),updateInventory(),updateBars()},n.onActivate=function(){WATER>=1.5?(WATER-=1.5,THIRST=Math.min(THIRST+25,100),TEMPERATURE>=37.25?TEMPERATURE-=.25:36.75>=TEMPERATURE?TEMPERATURE+=.25:TEMPERATURE=37):WATER>0?(THIRST=Math.min(THIRST+25*(WATER/1.5),100),WATER=0):new Pane({title:DIALOG.water[LANGUAGE].toUpperCase(),message:DIALOG.outOfWater[LANGUAGE],center:!0,layer:ui}),updateInventory(),updateBars()},t.onActivate=function(){var a=new Pane({width:300,height:100,title:DIALOG.rest[LANGUAGE].toUpperCase(),message:DIALOG.verifyRest[LANGUAGE],center:!0,buttons:2,layer:ui});a.button.destroy(),a.option1.text.setText(DIALOG.yes[LANGUAGE]),a.option2.text.setText(DIALOG.no[LANGUAGE]),a.option1.base.fill("#44FF44"),a.option2.base.fill("#FF4444"),a.option1.refreshColors(),a.option2.refreshColors(),a.option1.onActivate=function(){y.isRunning()||x.isRunning()||(RESTING=!0,B(),a.close())},a.option2.onActivate=function(){a.close()},a.draw()};var w=b.fill(),x=new Kinetic.Animation(function(d){var e=d.time/3e3;0>e||e>1?(x.stop(),a.fill("#001848"),b.fill(shadeColor(GROUND_COLOR,-50)),w=shadeColor(GROUND_COLOR,-50),c.opacity(1),"idle"==CHARACTER.animation()&&CHARACTER.animation("walking"),d.time=0):(c.visible()||c.visible(!0),z.isRunning()||z.start(),a.fill(blendColors("#a8d8fc","#001848",e)),b.fill(blendColors(w,shadeColor(GROUND_COLOR,-50),e)),c.opacity(e))},background),y=new Kinetic.Animation(function(d){var e=d.time/3e3;0>e||e>1?(y.stop(),a.fill("#a8d8fc"),b.fill(GROUND_COLOR),w=GROUND_COLOR,c.opacity(0),c.visible(!1),z.stop(),"idle"==CHARACTER.animation()&&CHARACTER.animation("walking"),A(),d.time=0):(a.fill(blendColors("#001848","#a8d8fc",e)),b.fill(blendColors(w,GROUND_COLOR,e)),c.opacity(1-e))},background),z=new Kinetic.Animation(function(a){if(c.visible()){c.position({x:c.x()+.001*a.timeDiff,y:c.y()+.001*a.timeDiff});for(var b=0;b<c.children.length;b++)c.children[b].rotate(360*c.children[b].angularSpeed*a.timeDiff/1e3);(c.x()>0||c.y()>0)&&(c.position({x:-1*HEIGHT/3,y:-1*HEIGHT/3}),A())}else a.time=0,(0!=c.x()||0!=c.y())&&c.position({x:-1*HEIGHT/3,y:-1*HEIGHT/3})},background),A=function(){for(var a=0;a<c.children.length;a++)c.children[a].position({x:Math.random()*c.getWidth(),y:Math.random()*c.getHeight()})};v.onActivate=function(){0==y.isRunning()&&0==x.isRunning()&&B()},nextCycle=function(){0==y.isRunning()&&0==x.isRunning()&&B()},inTransition=function(){return y.isRunning()||x.isRunning()?!0:void 0},c.visible(!1),background.add(a),background.add(c),background.add(b),foreground.add(CHARACTER),CHARACTER.start(),STAGE.draw();var B=function(){var a=function(){HUNGER-=6*Math.random()-2+7.15,THIRST-=10*Math.random()-5+12.5,ENERGY-=4*Math.random()-2+4.5,FOOD-=.0715*FOOD,BIOME==BIOMES.DESERT?CYCLE==TIME_OF_DAY.NIGHT?ENVIRONMENTAL_TEMPERATURE+=20*Math.random()+10:ENVIRONMENTAL_TEMPERATURE-=20*Math.random()+10:BIOME==BIOMES.SAVANNA?CYCLE==TIME_OF_DAY.NIGHT?ENVIRONMENTAL_TEMPERATURE+=10*Math.random()+5:ENVIRONMENTAL_TEMPERATURE-=10*Math.random()+5:BIOME==BIOMES.TROPICAL&&(CYCLE==TIME_OF_DAY.NIGHT?ENVIRONMENTAL_TEMPERATURE+=5*Math.random()+3:ENVIRONMENTAL_TEMPERATURE-=5*Math.random()+3),TEMPERATURE=(1-THIRST/100+1)*(1113e-7*Math.pow(ENVIRONMENTAL_TEMPERATURE,3)+-.007346*Math.pow(ENVIRONMENTAL_TEMPERATURE,2)+.1919*ENVIRONMENTAL_TEMPERATURE)+35.15,(hasEffect(AILMENT_TYPES.TUBERCULOSIS)||hasEffect(AILMENT_TYPES.DENGUE_FEVER))&&(THIRST-=2*Math.random()),hasEffect(AILMENT_TYPES.DIARRHEA)&&(THIRST-=5*Math.random()),hasEffect(AILMENT_TYPES.MALNUTRITION)&&(ENERGY-=2*Math.random()),RESTING?(CHARACTER.animation("idle"),ENERGY+=4*Math.random()-2+9,hasEffect(AILMENT_TYPES.SCABIES)&&(ENERGY-=2*Math.random()),TEMPERATURE-=1):TEMPERATURE+=1,updateBars(),updateInventory()},b=function(){for(var a=0,b=0;b<PROBABILITIES.length;b++)a+=PROBABILITIES[b][0];if(Math.random()<=.75)console.log("Nothing interesting happened this day.");else for(var c=!1;0==c;){var d=Math.random()*a,e=0,f=0;for(e=0;e<PROBABILITIES.length-1&&(f+=PROBABILITIES[e][0],!(f>=d));e++);c=PROBABILITIES[e][1]()}};RESTING||RIDING_LA_BESTIA||WITH_COYOTE?(CYCLE==TIME_OF_DAY.NIGHT?(y.start(),CYCLE=TIME_OF_DAY.DAY,DAYS++):(x.start(),CYCLE=TIME_OF_DAY.NIGHT),a(),RESTING&&RIDING_LA_BESTIA?Math.random()<=.5?die(DIALOG.chanceLaBestiaFallOffDie[LANGUAGE]):(addEffect(AILMENT_TYPES.BROKEN_LIMB,AILMENTS),new Pane({message:DIALOG.chanceLaBestiaFallOff[LANGUAGE],height:150,title:DIALOG.laBestia[LANGUAGE],layer:ui}),RIDING_LA_BESTIA=!1):RIDING_LA_BESTIA&&(Math.random()<=.1?die(DIALOG.chanceLaBestiaFallOffDie[LANGUAGE]):Math.random()<=.1?(addEffect(AILMENT_TYPES.BROKEN_LIMB,AILMENTS),new Pane({message:DIALOG.chanceLaBestiaFallOff[LANGUAGE],height:150,title:DIALOG.laBestia[LANGUAGE],layer:ui}),RIDING_LA_BESTIA=!1):REPORTED_TO_AUTHORITIES&&Math.random()<=.2?Math.random()<=.5?die(DIALOG.chanceLaBestiaApprehended[LANGUAGE]):(Math.random()<=.5?addEffect(AILMENT_TYPES.BROKEN_LIMB,AILMENTS):addEffect(AILMENT_TYPES.SPRAIN,AILMENTS),new Pane({message:DIALOG.chanceLaBestiaScaredOff[LANGUAGE],height:150,title:DIALOG.laBestia[LANGUAGE],layer:ui}),RIDING_LA_BESTIA=!1):Math.random()<=.1?Math.random()<=.5?die(DIALOG.chanceLaBestiaGangPushOffDie[LANGUAGE]):(Math.random()<=.5?addEffect(AILMENT_TYPES.BROKEN_LIMB,AILMENTS):addEffect(AILMENT_TYPES.SPRAIN,AILMENTS),new Pane({message:DIALOG.chanceLaBestiaGangPushOffInjure[LANGUAGE],height:150,title:DIALOG.laBestia[LANGUAGE],layer:ui}),RIDING_LA_BESTIA=!1):STEP+=roundTwoPlaces(50*Math.random()+250)),WITH_COYOTE&&(WITH_COYOTE=!1),RESTING=!1):(CYCLE==TIME_OF_DAY.NIGHT?(y.start(),CYCLE=TIME_OF_DAY.DAY,DAYS++):(x.start(),CYCLE=TIME_OF_DAY.NIGHT),a(),STEP+=hasEffect(AILMENT_TYPES.BROKEN_LIMB)?roundTwoPlaces(20*Math.random()+30):hasEffect(AILMENT_TYPES.SPRAIN)||hasEffect(AILMENT_TYPES.EXHAUSTION)||hasEffect(AILMENT_TYPES.TUBERCULOSIS)?roundTwoPlaces(20*Math.random()+40):roundTwoPlaces(20*Math.random()+50),hasEffect(PERK_TYPES.LIGHTWEIGHT)&&(STEP+=roundTwoPlaces(20*Math.random()+10)),b()),updateStatus(),updateRegions(),updateGroundColor()}};PROBABILITIES=[[7,function(){return hasEffect(AILMENT_TYPES.BROKEN_LIMB)?!1:(addEffect(AILMENT_TYPES.BROKEN_LIMB,AILMENTS),!0)}],[12,function(){return REGION!=REGIONS.SONORAN_DESERT&&hasEffect(AILMENT_TYPES.BROKEN_LIMB)?(removeEffect(AILMENT_TYPES.BROKEN_LIMB),new Pane({message:DIALOG.chanceGrupoBetaBrokenLimb[LANGUAGE],title:DIALOG.grupoBeta[LANGUAGE],layer:ui}),!0):!1}],[14,function(){if(REGION==REGIONS.SONORAN_DESERT&&(hasEffect(AILMENT_TYPES.DENGUE_FEVER)||hasEffect(AILMENT_TYPES.DIARRHEA)||hasEffect(AILMENT_TYPES.TUBERCULOSIS)||hasEffect(AILMENT_TYPES.SCABIES))){var a=new Pane({message:DIALOG.chanceDesertEncounter[LANGUAGE],title:DIALOG.encounter[LANGUAGE],height:125,yesNo:!0,noClose:!0,layer:ui});return a.option1.onActivate=function(){var b=new Pane({message:DIALOG.chanceFriendlyAmericanMedicine[LANGUAGE],title:DIALOG.friendlyAmerican[LANGUAGE],yesNo:!0,layer:ui});b.option1.onActivate=function(){removeEffect(AILMENT_TYPES.DENGUE_FEVER),removeEffect(AILMENT_TYPES.DIARRHEA),removeEffect(AILMENT_TYPES.TUBERCULOSIS),removeEffect(AILMENT_TYPES.SCABIES),Math.random()<=.2&&(REPORTED_TO_AUTHORITIES=!0),b.close()},a.close()},!0}return!1}],[3,function(){return REGION!=REGIONS.SONORAN_DESERT?(die(DIALOG.chanceLosZetasKill[LANGUAGE]),!0):!1}],[17,function(){var a=getLocalPrice(200*Math.random()+100);if(getLocalWallet()>=a){var b=Math.round(150*Math.random()+50),c=new Pane({message:DIALOG.chanceCoyote1[LANGUAGE]+b+DIALOG.chanceCoyote2[LANGUAGE]+getLocalDisplayPrice(a)+DIALOG.chanceCoyote3[LANGUAGE],title:DIALOG.coyote[LANGUAGE],yesNo:!0,height:125,layer:ui});return c.option1.onActivate=function(){if(!inTransition()){WITH_COYOTE=!0,nextCycle(),setLocalWallet(getLocalWallet()-a);var d=Math.random();.25>=d?(new Pane({message:DIALOG.coyoteMislead[LANGUAGE],title:DIALOG.coyote[LANGUAGE],layer:ui}),STEP=Math.max(STEP-b,0)):.5>=d?die(DIALOG.chanceCoyoteKill[LANGUAGE]):STEP+=b,c.close()}},!0}return!1}],[23,function(){if(REGION!=REGIONS.SONORAN_DESERT){var a=new Pane({message:DIALOG.chanceStore[LANGUAGE],title:DIALOG.store[LANGUAGE].toUpperCase(),buttons:2,noClose:!0,layer:ui});return a.option1.base.fill("#44FF44"),a.option2.base.fill("#FF4444"),a.option1.refreshColors(),a.option2.refreshColors(),a.option1.text.setText(DIALOG.yes[LANGUAGE]),a.option2.text.setText(DIALOG.no[LANGUAGE]),a.option1.onActivate=function(){storeMenu(),a.close()},a.option2.onActivate=function(){a.close()},a.draw(),!0}return!1}],[15,function(){return hasEffect(AILMENT_TYPES.DENGUE_FEVER)?!1:(addEffect(AILMENT_TYPES.DENGUE_FEVER,AILMENTS),!0)}],[6,function(){return QUETZALES>=2300?(QUETZALES*=Math.random()*(.8-.6)+.6,new Pane({message:DIALOG.chanceMaraSalvatruchaRob[LANGUAGE],title:DIALOG.maraSalvatrucha[LANGUAGE],layer:ui}),!0):US_DOLLARS>=300?(US_DOLLARS*=Math.random()*(.8-.6)+.6,new Pane({message:DIALOG.chanceMaraSalvatruchaRob[LANGUAGE],title:DIALOG.maraSalvatrucha[LANGUAGE],layer:ui}),!0):PESOS>=4400?(PESOS*=Math.random()*(.8-.6)+.6,new Pane({message:DIALOG.chanceMaraSalvatruchaRob[LANGUAGE],title:DIALOG.maraSalvatrucha[LANGUAGE],layer:ui}),!0):LEMPIRAS>=6300?(LEMPIRAS*=Math.random()*(.8-.6)+.6,new Pane({message:DIALOG.chanceMaraSalvatruchaRob[LANGUAGE],title:DIALOG.maraSalvatrucha[LANGUAGE],layer:ui}),!0):!1}],[15,function(){return REPORTED_TO_AUTHORITIES?(die(DIALOG.chanceApprehended[LANGUAGE]),!0):!1}],[18,function(){var a=getLocalPrice(200*Math.random()+200);if(getLocalWallet()>=a&&0==RIDING_LA_BESTIA){var b=new Pane({message:DIALOG.chanceLaBestia[LANGUAGE],title:DIALOG.laBestia[LANGUAGE],yesNo:!0,layer:ui});return b.option1.onActivate=function(){if(!inTransition()){if(Math.random()<=.5)RIDING_LA_BESTIA=!0,nextCycle();else{var c=new Pane({message:DIALOG.chanceLaBestiaToll1[LANGUAGE]+getLocalDisplayPrice(a)+DIALOG.chanceLaBestiaToll2[LANGUAGE],title:DIALOG.laBestia[LANGUAGE],height:125,yesNo:!0,layer:ui});c.option1.onActivate=function(){setLocalWallet(getLocalWallet()-a),updateInventory(),RIDING_LA_BESTIA=!0,nextCycle(),c.close()}}b.close()}},!0}return!1}],[20,function(){if(BIOME==BIOMES.TROPICAL){var a=new Pane({message:DIALOG.chanceBananaFarm[LANGUAGE],title:DIALOG.food[LANGUAGE],yesNo:!0,layer:ui});return a.option1.onActivate=function(){if(Math.random()<=.75){var b=8*Math.random();FOOD=Math.min(MAX_CARRY_WEIGHT-WATER,FOOD+b),updateInventory()}else new Pane({message:DIALOG.chanceBananaFarmShoo[LANGUAGE],title:DIALOG.food[LANGUAGE],layer:ui}),Math.random()<=.25&&(REPORTED_TO_AUTHORITIES=!0);a.close()},!0}return!1}],[25,function(){new Pane({message:DIALOG.chanceSupplies[LANGUAGE],title:DIALOG.supplies[LANGUAGE],layer:ui});var a=8*Math.random(),b=8*Math.random();return WATER=Math.min(MAX_CARRY_WEIGHT-FOOD,WATER+a),FOOD=Math.min(MAX_CARRY_WEIGHT-WATER,FOOD+b),updateInventory(),!0}],[23,function(){if(REGION!=REGIONS.SONORAN_DESERT){var a=getLocalPrice(20*Math.random()+60),b=new Pane({message:DIALOG.chanceOddJob1[LANGUAGE]+getLocalDisplayPrice(a)+DIALOG.chanceOddJob2[LANGUAGE],title:DIALOG.oddJob[LANGUAGE],yesNo:!0,layer:ui});return b.option1.onActivate=function(){inTransition()||(RESTING=!0,setLocalWallet(getLocalWallet()+a),Math.random()<=.25&&(REPORTED_TO_AUTHORITIES=!0),nextCycle(),b.close())},!0}return!1}],[18,function(){if(REGION==REGIONS.SONORAN_DESERT){var a=new Pane({message:DIALOG.chanceBarrels[LANGUAGE],title:DIALOG.water[LANGUAGE],yesNo:!0,layer:ui});return THIRST=100,updateBars(),updateStatus(),a.option1.onActivate=function(){WATER=Math.min(MAX_CARRY_WEIGHT-FOOD,WATER+6),updateInventory(),a.close()},!0}return!1}],[12,function(){if(REGION!=REGIONS.SONORAN_DESERT){var a=new Pane({message:DIALOG.chanceShelter[LANGUAGE],title:DIALOG.shelter[LANGUAGE],yesNo:!0,layer:ui});return a.option1.onActivate=function(){inTransition()||(Math.random()<=.15?(die(DIALOG.chanceShelterRaid[LANGUAGE]),a.close()):(RESTING=!0,nextCycle(),ENERGY=100,THIRST=100,HUNGER=100,TEMPERATURE=37,5>FOOD&&(FOOD=5),5>WATER&&(WATER=5),updateBars(),updateStatus(),updateInventory(),a.close()))},!0}return!1}],[8,function(){if(REGION==REGIONS.SONORAN_DESERT){var a=new Pane({message:DIALOG.chanceDesertEncounter[LANGUAGE],title:DIALOG.encounter[LANGUAGE],height:125,yesNo:!0,noClose:!0,layer:ui});return a.option1.onActivate=function(){new Pane({message:DIALOG.chancePatriot[LANGUAGE],height:125,title:DIALOG.patriot[LANGUAGE],layer:ui}),REPORTED_TO_AUTHORITIES=!0,a.close()},!0}return!1}],[10,function(){if(hasEffect(PERK_TYPES.OUTDOORSMAN)){if(Math.random()<=.5){new Pane({message:DIALOG.chanceOutdoorsmanFindWater[LANGUAGE],title:DIALOG.outdoorsman[LANGUAGE],layer:ui});var a=8*Math.random();WATER=Math.min(MAX_CARRY_WEIGHT-FOOD,WATER+a)}else{new Pane({message:DIALOG.chanceOutdoorsmanFindFood[LANGUAGE],title:DIALOG.outdoorsman[LANGUAGE],layer:ui});var b=8*Math.random();FOOD=Math.min(MAX_CARRY_WEIGHT-WATER,FOOD+b)}return updateInventory(),!0}return!1}],[17,function(){return hasEffect(AILMENT_TYPES.DIARRHEA)?!1:(addEffect(AILMENT_TYPES.DIARRHEA,AILMENTS),!0)}],[12,function(){return hasEffect(AILMENT_TYPES.SCABIES)?!1:(addEffect(AILMENT_TYPES.SCABIES,AILMENTS),!0)}],[21,function(){return hasEffect(AILMENT_TYPES.SPRAIN)?!1:(addEffect(AILMENT_TYPES.SPRAIN,AILMENTS),!0)}],[4,function(){return die(DIALOG.chanceApprehended[LANGUAGE]),!0}],[14,function(){return hasEffect(AILMENT_TYPES.DIARRHEA)?(removeEffect(AILMENT_TYPES.DIARRHEA),!0):!1}],[17,function(){return hasEffect(AILMENT_TYPES.SPRAIN)?(removeEffect(AILMENT_TYPES.SPRAIN),!0):!1}],[12,function(){if(BIOME==BIOMES.DESERT&&!hasEffect(PERK_TYPES.OUTDOORSMAN)){var a=new Pane({message:DIALOG.chanceDesertStream[LANGUAGE],title:DIALOG.water[LANGUAGE],yesNo:!0,layer:ui});return a.option1.onActivate=function(){Math.random()<=.25?die(DIALOG.chanceDesertStreamDrown[LANGUAGE]):(THIRST=100,updateBars(),updateStatus(),WATER=Math.min(MAX_CARRY_WEIGHT-FOOD,WATER+8*Math.random()),updateInventory(),a.close())},!0}return!1}]];